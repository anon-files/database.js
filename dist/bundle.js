(()=>{var Q=(V=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(V,{get:(z,W)=>(typeof require!="undefined"?require:z)[W]}):V)(function(V){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+V+'" is not supported')});(()=>{var V=(G=>typeof Q<"u"?Q:typeof Proxy<"u"?new Proxy(G,{get:(H,b)=>(typeof Q<"u"?Q:H)[b]}):G)(function(G){if(typeof Q<"u")return Q.apply(this,arguments);throw new Error('Dynamic require of "'+G+'" is not supported')}),z=(G,H)=>()=>(H||G((H={exports:{}}).exports,H),H.exports),W=z((G,H)=>{(function(){function b($,t){return t?V($):$.slice?b[r($)]:function(u,l){$(u={exports:{}}),b[r(l)]=u.exports};function r(u){return u.split("/").slice(-1).toString().replace(".js","")}}if(typeof H<"u")var Y=H;b(function($){String.random=function(e,n){var g="";for(e=e||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<e--;)g+=n.charAt(Math.floor(Math.random()*n.length));return g},String.match=function(e,n){var g,w;return typeof e=="string"&&(typeof n=="string"&&(n={"=":n}),e===(g=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||w===n["="]&&(g=n["*"]||n[">"],e.slice(0,(g||"").length)===g||w===n["*"]&&(w!==n[">"]&&w!==n["<"]?e>=n[">"]&&e<=n["<"]:w!==n[">"]&&e>=n[">"]||w!==n["<"]&&e<=n["<"])))},String.hash=function(e,n){if(typeof e=="string"){if(n=n||0,!e.length)return n;for(var g=0,w=e.length;g<w;++g)n=(n<<5)-n+e.charCodeAt(g),n|=0;return n}};var t,r,u,l,o,a,i,f,k,h,d,y,s,c,v=Object.prototype.hasOwnProperty;Object.plain=function(e){return!!e&&(e instanceof Object&&e.constructor===Object||Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1]==="Object")},Object.empty=function(e,n){for(var g in e)if(v.call(e,g)&&(!n||n.indexOf(g)==-1))return!1;return!0},Object.keys=Object.keys||function(e){var n=[];for(var g in e)v.call(e,g)&&n.push(g);return n},t=setTimeout,u=r=0,l=typeof setImmediate!=""+void 0&&setImmediate||t,t.hold=t.hold||9,t.poll=t.poll||function(e){t.hold>=+new Date-r&&u++<3333?e():l(function(){r=+new Date,e()},u=0)},a=setTimeout,f=(i=a.turn=a.turn||function(e){f.push(e)==1&&k(d)}).s=[],k=a.poll,h=0,d=function(){(o=f[h++])&&o(),h!=f.length&&h!=99||(f=i.s=f.slice(h),h=0),f.length&&k(d)},s=setTimeout,c=s.turn,(s.each=s.each||function(e,n,g,w){w=w||9,function S(x,T,A){if(T=(x=(e||[]).splice(0,w)).length){for(var D=0;D<T&&y===(A=n(x[D]));D++);if(y===A)return void c(S)}g&&g(A)}()})()})(b,"./shim"),b(function($){$.exports=function t(r,u,l){if(!r)return{to:t};var o=typeof u=="function";if(r=(this.tag||(this.tag={}))[r]||o&&(this.tag[r]={tag:r,to:t._={next:function(i){var f;(f=this.to)&&f.next(i)}}}),o){var a={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:u,the:r,on:this,as:l};return(a.back=r.last||r).to=a,r.last=a}return(r=r.to)&&u!==void 0&&r.next(u),r}})(b,"./onto"),b(function($){$.exports=function(t){return t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"&&t!=1/0&&t!=-1/0&&t==t||!!t&&typeof t["#"]=="string"&&Object.keys(t).length===1&&t["#"]}})(b,"./valid"),b(function($){function t(){var o=+new Date;return l=l<o?(r=0,o+t.drift):o+(r+=1)/u+t.drift}b("./shim"),t.drift=0;var r=0,u=999,l=-1/0;t.is=function(o,a,i){var f=a&&o&&o._&&o._[">"]||i;if(f)return typeof(f=f[a])=="number"?f:-1/0},t.ify=function(o,a,i,f,k){(o=o||{})._=o._||{},k&&(o._["#"]=k);var h=o._[">"]||(o._[">"]={});return a!==void 0&&a!=="_"&&(typeof i=="number"&&(h[a]=i),f!==void 0&&(o[a]=f)),o},$.exports=t})(b,"./state"),b(function($){b("./shim"),$.exports=function(t){var r={s:{}},u=r.s;t=t||{max:999,age:9e3},r.check=function(o){return!!u[o]&&l(o)};var l=r.track=function(o){var a=u[o]||(u[o]={});return a.was=r.now=+new Date,r.to||(r.to=setTimeout(r.drop,t.age+9)),a};return r.drop=function(o){r.to=null,r.now=+new Date;var a=Object.keys(u);console.STAT&&console.STAT(r.now,+new Date-r.now,"dup drop keys"),setTimeout.each(a,function(i){var f=u[i];f&&(o||t.age)>r.now-f.was||delete u[i]},0,99)},r}})(b,"./dup"),b(function($){b("./onto"),$.exports=function(r,u){if(this.on){var l=(this.opt||{}).lack||9e3;if(typeof r!="function"){if(!r)return;var o=r["#"]||r,a=(this.tag||"")[o];return a?(u&&(a=this.on(o,u),clearTimeout(a.err),a.err=setTimeout(function(){a.off()},l)),!0):void 0}if(o=u&&u["#"]||t(9),!r)return o;var i=this.on(o,r,u);return i.err=i.err||setTimeout(function(){i.off(),i.next({err:"Error: No ACK yet.",lack:!0})},l),o}};var t=String.random||function(){return Math.random().toString(36).slice(2)}})(b,"./ask"),b(function($){function t(y){return y instanceof t?(this._={$:this}).$:this instanceof t?t.create(this._={$:this,opt:y}):new t(y)}function r(y,s){var c=+new Date,v=y._||{},e=v.DBG=y.DBG,n=y["#"],g=a(9),w=Object.keys(s||"").sort(),S=((s||"")._||"")["#"],x=(w.length,y.$._.root),T=s===x.graph[S];console.STAT&&console.STAT(c,((e||v).gk=+new Date)-c,"got keys"),s&&function A(){c=+new Date;for(var D,C,m,O=0,E={};O<9&&(D=w[O++]);)h(E,D,k(s,D),s[D],S);w=w.slice(O),(C={})[S]=E,E=C,T&&((m=function(){}).ram=m.faith=!0),C=w.length,console.STAT&&console.STAT(c,-(c-(c=+new Date)),"got copied some"),e&&(e.ga=+new Date),x.on("in",{"@":n,"#":g,put:E,"%":C?g=a(9):u,$:x.$,_:m,DBG:e}),console.STAT&&console.STAT(c,+new Date-c,"got in"),C&&setTimeout.turn(A)}(),s||x.on("in",{"@":y["#"]})}t.is=function(y){return y instanceof t||y&&y._&&y===y._.$||!1},t.version=.202,(t.chain=t.prototype).toJSON=function(){},b("./shim"),t.valid=b("./valid"),t.state=b("./state"),t.on=b("./onto"),t.dup=b("./dup"),t.ask=b("./ask"),function(){function y(m){if(m)if(m.out!==y){var O,E=this.as,P=E.at||E,q=P.$,M=P.dup,J=m.DBG;if((O=m["#"])||(O=m["#"]=a(9)),!M.check(O)){if(M.track(O),O=m._,m._=typeof O=="function"?O:function(){},m.$&&m.$===(m.$._||"").$||(m.$=q),m["@"]&&!m.put&&function(I){var K,F=I["@"]||"";!(K=F._)||(K.acks=(K.acks||0)+1,(K.err=I.err)&&(I["@"]=K["#"],e(K)),K.stop||K.crack||(K.crack=K.match&&K.match.push(function(){n(K)})),n(K))}(m),!P.ask(m["@"],m)){if(J&&(J.u=+new Date),m.put)return void s(m);m.get&&t.on.get(m,q)}J&&(J.uc=+new Date),this.to.next(m),J&&(J.ua=+new Date),m.nts||m.NTS||(m.out=y,P.on("out",m),J&&(J.ue=+new Date))}}else this.to.next(m)}function s(m){if(m){var O=m._||"",E=O.root=((O.$=m.$||"")._||"").root;if(m["@"]&&O.faith&&!O.miss)return m.out=y,void E.on("out",m);O.latch=E.hatch,O.match=E.hatch=[];var P=m.put,q=O.DBG=m.DBG,M=+new Date;if(g=g||M,!P["#"]||!P["."]){q&&(q.p=M),O["#"]=m["#"],O.msg=m,O.all=0,O.stun=1;var J=Object.keys(P);console.STAT&&console.STAT(M,((q||O).pk=+new Date)-M,"put sort");var I,K,F,X,tt,B,p,_=0;(function j(N){if(I!=_){if(!(F=J[I=_]))return console.STAT&&console.STAT(M,((q||O).pd=+new Date)-M,"put"),void e(O);(X=P[F])?(p=X._)?F!==p["#"]?B=w+S(F)+"soul not same.":(tt=p[">"])||(B=w+S(F)+"no state."):B=w+S(F)+"no meta.":B=w+S(F)+"no node.",K=Object.keys(X||{})}if(B)return m.err=O.err=B,void e(O);var U,R=0;for(N=N||0;N++<9&&(U=K[R++]);)if(U!=="_"){var L=X[U],et=tt[U];if(u===et){B=w+S(U)+"on"+S(F)+"no state.";break}if(!f(L)){B=w+S(U)+"on"+S(F)+"bad "+typeof L+S(L);break}c(L,U,F,et,m),++D}(K=K.slice(R)).length?i(j):(++_,K=null,j(N))})()}}}function c(m,O,E,P,q){var M,J=q._||"",I=J.root,K=I.graph,F=K[E]||d,X=k(F,O,1),tt=F[O],B=J.DBG;(M=console.STAT)&&(K[E]&&tt||(M.has=(M.has||0)+1));var p=A();if(p<P)return setTimeout(function(){c(m,O,E,P,q)},(M=P-p)>T?T:M),void(console.STAT&&console.STAT((B||J).Hf=+new Date,M,"future"));if((!(P<X)||J.miss)&&(J.faith||P!==X||!(m===tt||x(m)<=x(tt))||J.miss)){J.stun++;var _=q["#"]+J.all++,j={toString:function(){return _},_:J};j.toJSON=j.toString,B&&(B.ph=B.ph||+new Date),I.on("put",{"#":j,"@":q["@"],put:{"#":E,".":O,":":m,">":P},_:J})}}function v(m){var O;(O=(m._||"").DBG)&&(O.pa=+new Date,O.pm=O.pm||+new Date);var E,P=this.as,q=P.graph,M=m._,J=m.put,I=J["#"],K=J["."],F=J[":"],X=J[">"];m["#"],(E=M.msg)&&(E=E.put)&&(E=E[I])&&h(E,K,X,F,I),q[I]=h(q[I],K,X,F,I),(E=(P.next||"")[I])&&E.on("in",m),e(M),this.to.next(m)}function e(m,O){var E;if(!m.stop&&(m.err||!(0<--m.stun))&&(m.stop=1,E=m.root)){var P=m.match;P.end=1,P===E.hatch&&(!(P=m.latch)||P.end?delete E.hatch:E.hatch=P),m.hatch&&m.hatch(),setTimeout.each(m.match,function(q){q&&q()}),!(O=m.msg)||m.err||O.err||(O.out=y,m.root.on("out",O),C())}}function n(m){m&&m.root&&(m.stun||m.acks!==m.all||m.root.on("in",{"@":m["#"],err:m.err,ok:m.err?u:{"":1}}))}t.create=function(m){m.root=m.root||m,m.graph=m.graph||{},m.on=m.on||t.on,m.ask=m.ask||t.ask,m.dup=m.dup||t.dup();var O=m.$.opt(m.opt);return m.once||(m.on("in",y,m),m.on("out",y,m),m.on("put",v,m),t.on("create",m),m.on("create",m)),m.once=1,O},t.on.put=s;var g,w="Error: Invalid graph!",S=function(m){return" '"+(""+m).slice(0,9)+"...' "},x=JSON.stringify,T=2147483647,A=t.state,D=0,C=function(){999<D&&1<D/-(g-(g=+new Date))&&(t.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),C=function(){D=0})}}(),t.on.get=function(y,s){var c=s._,v=y.get,e=v["#"],n=c.graph[e],g=v["."],w=((c.next||(c.next={}))[e],(y._||{}).DBG=y.DBG);if(w&&(w.g=+new Date),!n)return c.on("get",y);if(g){if(typeof g!="string"||u===n[g])return c.on("get",y);n=h({},g,k(n,g),n[g],e)}n&&r(y,n),c.on("get",y)},t.on.get.ack=r,t.chain.opt=function(y){y=y||{};var s=this._,c=y.peers||y;return Object.plain(y)||(y={}),Object.plain(s.opt)||(s.opt=y),typeof c=="string"&&(c=[c]),Object.plain(s.opt.peers)||(s.opt.peers={}),c instanceof Array&&(y.peers={},c.forEach(function(v){var e={};e.id=e.url=v,y.peers[v]=s.opt.peers[v]=s.opt.peers[v]||e})),o(y,function v(e){var n=this[e];this&&this.hasOwnProperty(e)||typeof n=="string"||Object.empty(n)?this[e]=n:(!n||n.constructor===Object||n instanceof Array)&&o(n,v)}),s.opt.from=y,t.on("opt",s),s.opt.uuid=s.opt.uuid||function(v){return t.state().toString(36).replace(".","")+String.random(v||12)},this};var u,l,o=function(y,s){Object.keys(y).forEach(s,y)},a=String.random,i=setTimeout.turn,f=t.valid,k=t.state.is,h=t.state.ify,d={};(t.log=function(){return t.log.off||l.log.apply(l,arguments),[].slice.call(arguments).join(" ")}).once=function(y,s,c){return(c=t.log.once)[y]=c[y]||0,c[y]++||t.log(s)},typeof window<"u"&&((window.Database=t).window=window);try{Y!==void 0&&(Y.exports=t)}catch{}(($.exports=t).window||{}).console=(t.window||{}).console||{log:function(){}},(l=console).only=function(y,s){return l.only.i&&y===l.only.i&&l.only.i++&&(l.log.apply(l,arguments)||s)}})(b,"./root"),b(function($){b("./root").chain.back=function(r,u){if((r=r||1)===-1||1/0===r)return this._.root.$;if(r===1)return(this._.back||this._).$;var l=this._;if(typeof r=="string"&&(r=r.split(".")),r instanceof Array){for(var o=0,a=r.length,i=l;o<a;o++)i=(i||t)[r[o]];return i!==void 0?u?this:i:(i=l.back)?i.$.back(r,u):void 0}if(typeof r!="function")return typeof r=="number"?(l.back||l).$.back(r-1):this;var f;for(i={back:l};(i=i.back)&&(f=r(i,u))===void 0;);return f};var t={}})(b,"./back"),b(function($){var t=b("./root");function r(s,c){if(c=c||this.as||s.$._,(!s.$$||this===t.on)&&s.put&&!c.soul){var v=s.put||"",e=v["="]||v[":"],n=c.root,g=n.$.get(v["#"]).get(v["."])._;if(typeof(e=f(e))=="string"){if(!(g.echo||(g.echo={}))[c.id]||(n.pass||"")[c.id]){if(w=n.pass){if(w[e+c.id])return;w[e+c.id]=1}((g.echo||(g.echo={}))[c.id]=c).has&&(c.link=e);var w,S=n.$.get(g.link=e)._;(S.echo||(S.echo={}))[g.id]=g,((w=c.ask||"")[""]||c.lex)&&S.on("out",{get:{"#":e}}),setTimeout.each(Object.keys(w),function(x,T){x&&(T=w[x])&&T.on("out",{get:{"#":e,".":x}})},0,99)}}else this===t.on&&((g.echo||(g.echo={}))[c.id]=c)}}function u(s,c){var v,e,n=s.put||"",g=o!==n["="]?n["="]:n[":"],w=c.root;if(o===g)return c.soul&&o!==c.put||(e=(s.$$||s.$||"")._||"",s["@"]&&(o!==e.put||o!==c.put))?void 0:((v=c.link||s.linked)&&delete(w.$.get(v)._.echo||"")[c.id],c.has&&(c.link=null),c.put=o,void setTimeout.each(Object.keys(c.next||""),function(S,x){(x=c.next[S])&&(v&&delete(w.$.get(v).get(S)._.echo||"")[x.id],x.on("in",{get:S,put:o,$:x.$}))},0,99));c.soul||s.$$||(v=f(g),e=s.$._||"",(v!==e.link&&(!c.has||e.link)||(w.pass||"")[c.id]&&typeof v!="string")&&(delete(e.echo||"")[c.id],u({get:c.get,put:o,$:s.$,linked:s.linked=s.linked||e.link},c)))}function l(s,c){var v=this.as,e=v.$._,n=(e.root,v.get||""),g=(s.put||"")[n["#"]]||"";if(!s.put||typeof n["."]=="string"&&o===g[n["."]])return o!==e.put||!e.soul&&!e.has?void 0:(e.ack=(e.ack||0)+1,void e.on("in",{get:e.get,put:e.put=o,$:e.$,"@":s["@"]}));(s._||{}).miss=1,t.on.put(s)}t.chain.chain=function(s){var c,v=this._,e=new(s||this).constructor(this),n=e._;return n.root=c=v.root,n.id=++c.once,n.back=this._,n.on=t.on,n.on("in",t.on.in,n),n.on("out",t.on.out,n),e},t.on.out=function(s){var c,v,e=this.as,n=e.back,g=e.root;if(s.$||(s.$=e.$),this.to.next(s),!e.err){if(c=s.get){if(g.pass&&(g.pass[e.id]=e),e.lex&&Object.keys(e.lex).forEach(function(w){v[w]=e.lex[w]},v=s.get=s.get||{}),c["#"]||e.soul){if(c["#"]=c["#"]||e.soul,s["#"]||(s["#"]=i(9)),n=g.$.get(c["#"])._,c=c["."]){if(k(n.put,c)&&(v=n.ask&&n.ask[c],(n.ask||(n.ask={}))[c]=n.$.get(c)._,n.on("in",{get:c,put:{"#":n.soul,".":c,":":n.put[c],">":d(g.graph[n.soul],c)}}),v))return}else{if(v=n.ask&&n.ask[""],(n.ask||(n.ask={}))[""]=n,o!==n.put&&(n.on("in",n),v))return;s.$=n.$}return g.ask(l,s),g.on("in",s)}if(c["."])return e.get?(s={get:{".":e.get},$:e.$},(n.ask||(n.ask={}))[e.get]=s.$._):s={get:e.lex?s.get:{},$:e.$},n.on("out",s);if(((e.ask||(e.ask={}))[""]=e).get)return c["."]=e.get,(n.ask||(n.ask={}))[e.get]=s.$._,n.on("out",s)}return n.on("out",s)}e.on("in",{put:e.put=o,$:e.$})},t.on.in=function(s,c){var v,e=(c=c||this.as).root,n=s.$||(s.$=c.$),g=(n||"")._||a,w=s.put||"",S=w["#"],x=w["."],T=o!==w["="]?w["="]:w[":"],A=w[">"]||-1/0;if(o!==s.put&&(o===w["#"]||o===w["."]||o===w[":"]&&o===w["="]||o===w[">"]))return f(w)?void c.on("in",{$:g.back.$,put:{"#":S=g.back.soul,".":x=g.has||g.get,"=":w,">":d(g.back.put,x)},via:s}):(S=((w||"")._||"")["#"])?(n=c.root.$.get(S),setTimeout.each(Object.keys(w).sort(),function(D){D!="_"&&o!==(A=d(w,D))&&c.on("in",{$:n,put:{"#":S,".":D,"=":w[D],">":A},VIA:s})})):void console.log("chain not yet supported for",w,"...",s,c);(s.seen||"")[c.id]||(((s.seen||(s.seen=function(){}))[c.id]=c)!==g&&(Object.keys(s).forEach(function(D){w[D]=s[D]},w={}),w.get=c.get||w.get,c.soul||c.has?g.soul&&(w.$=c.$,w.$$=w.$$||g.$):w.$$$=w.$$$||c.$,s=w),u(s,c),(c.soul||s.$$)&&A>=d(e.graph[S],x)&&((w=e.$.get(S)._).put=y(w.put,x,A,T,S)),!g.soul&&A>=d(e.graph[S],x)&&(v=(e.$.get(S)._.next||"")[x])&&(v.put=T,typeof(w=f(T))=="string"&&(v.put=e.$.get(w)._.put||T)),this.to&&this.to.next(s),c.any&&setTimeout.each(Object.keys(c.any),function(D){(D=c.any[D])&&D(s)},0,99),c.echo&&setTimeout.each(Object.keys(c.echo),function(D){(D=c.echo[D])&&D.on("in",s)},0,99),((s.$$||"")._||g).soul&&(v=c.next)&&(v=v[x])&&(w={},Object.keys(s).forEach(function(D){w[D]=s[D]}),w.$=(s.$$||s.$).get(w.get=x),delete w.$$,delete w.$$$,v.on("in",w)),r(s,c))},t.on.link=r,t.on.unlink=u;var o,a={},i=String.random,f=t.valid,k=function(s,c){return s&&Object.prototype.hasOwnProperty.call(s,c)},h=t.state,d=h.is,y=h.ify})(b,"./chain"),b(function($){var t=b("./root");function r(a){var i=this.at||this.on;if(!a||i.soul||i.has)return this.off();if(a=(a=(a=a.$||a)._||a).id){var f;if(i.map,(f=this.seen||(this.seen={}))[a])return!0;f[a]=!0}}t.chain.get=function(a,i,f){var k,h;if(typeof a=="string"){if(a.length==0)return(k=this.chain())._.err={err:t.log("0 length key!",a)},i&&i.call(k,k._.err),k;(k=((s=this._).next||l)[a])||(k=a&&function(n,g){var w=g._,S=w.next,x=g.chain()._;return S=S||(w.next={}),S[x.get=n]=x,g===w.root.$?x.soul=n:(w.soul||w.has)&&(x.has=n),x}(a,this)),k=k&&k.$}else{if(typeof a=="function"){let n=function(g,w,S){if(!n.stun&&(!(x=v.pass)||x[y])){var x,T=g.$._,A=(g.$$||"")._,D=(A||T).put,C=!T.has&&!T.soul,m={};if(!C&&u!==D||(D=u===((x=g.put)||"")["="]?u===(x||"")[":"]?x:x[":"]:x["="]),typeof(x=t.valid(D))=="string"&&(D=u===(x=v.$.get(x)._.put)?c.not?u:D:x),!c.not||u!==D){if(u===c.stun){if((x=v.stun)&&x.on&&(s.$.back(function(O){if(x.on(""+O.id,m={}),(m.run||0)<n.id)return m}),m.run||x.on(""+T.id,m={}),!m.run&&A&&x.on(""+A.id,m={}),n.id>m.run&&(m.stun&&!m.stun.end||(m.stun=x.on("stun"),m.stun=m.stun&&m.stun.last),m.stun&&!m.stun.end)))return void((m.stun.add||(m.stun.add={}))[y]=function(){n(g,w,1)});if(u===D&&(S=0),(x=v.hatch)&&!x.end&&u===c.hatch&&!S)return e[T.$._.id]?void 0:(e[T.$._.id]=1,void x.push(function(){n(g,w,1)}));e={}}if(v.pass){if(v.pass[y+T.id])return;v.pass[y+T.id]=1}c.on?c.ok.call(T.$,D,T.get,g,w||n):c.v2020?c.ok(g,w||n):(Object.keys(g).forEach(function(O){x[O]=g[O]},x={}),(g=x).put=D,c.ok.call(c.as,g,w||n))}}};var d=n;if(i===!0)return function(g,w,S,x){var T,A=g._,D=0;if(T=A.soul||A.link)return w(T,x,A);if(A.jam)return A.jam.push([w,x]);A.jam=[[w,x]],g.get(function(C,m){if(!(u===C.put&&!A.root.opt.super&&(T=Object.keys(A.root.opt.peers).length)&&++D<=T)){m.rid(C);var O,E=(E=C.$)&&E._||{},P=0;for(T=A.jam,delete A.jam;O=T[P++];){var q=O[0];O=O[1],q&&q(E.link||E.soul||t.valid(C.put)||((C.put||{})._||{})["#"],O,C,m)}}},{out:{get:{".":!0}}})}(this,a,0,f),this;var y,s=(k=this)._,c=i||{},v=s.root;c.at=s,c.ok=a;var e={};return(((n.at=s).any||(s.any={}))[y=String.random(7)]=n).off=function(){n.stun=1,s.any&&delete s.any[y]},n.rid=r,n.id=c.run||++v.once,h=v.pass,(v.pass={})[y]=1,c.out=c.out||{get:{}},s.on("out",c.out),v.pass=h,k}if(typeof a=="number")return this.get(""+a,i,f);if(typeof(h=o(a))=="string")return this.get(h,i,f);(h=this.get.next)&&(k=h(this,a))}return k?i&&typeof i=="function"&&k.get(i,f):((k=this.chain())._.err={err:t.log("Invalid get request!",a)},i&&i.call(k,k._.err)),k};var u,l={},o=t.valid})(b,"./get"),b(function($){var t=b("./root");function r(f,k){if(k){k=(k._||"").id||k;var h,d=f.root.stun||(f.root.stun={on:t.on}),y={};f.stun||(f.stun=d.on("stun",function(){})),(h=d.on(""+k))&&h.the.last.next(y),y.run>=f.run||d.on(""+k,function(s){if(f.stun.end)return this.off(),void this.to.next(s);s.run=s.run||f.run,s.stun=s.stun||f.stun})}}function u(f){if(f.err)u.end(f.stun,f.root);else if(!f.todo.length&&!f.end&&Object.empty(f.wait)){f.end=1;var k,h=f.$.back(-1)._,d=h.root,y=h.ask(function(v){d.on("ack",v),v.err&&t.log(v),++s>(f.acks||0)&&this.off(),f.ack&&f.ack(v,this)},f.opt),s=0,c=f.stun;(k=function(){c&&(u.end(c,d),setTimeout.each(Object.keys(c=c.add||""),function(v){(v=c[v])&&v()}))}).hatch=k,f.via._.on("out",{put:f.out=f.graph,opt:f.opt,"#":y,_:k})}}t.chain.put=function(f,k,h){var d=this,y=d._,s=y.root;(h=h||{}).root=y.root,h.run||(h.run=s.once),r(h,y.id),h.ack=h.ack||k,h.via=h.via||d,h.data=h.data||f,h.soul||(h.soul=y.soul||typeof k=="string"&&k);var c=h.state=h.state||t.state();return typeof f=="function"?f(function(v){h.data=v,d.put(void 0,void 0,h)}):h.soul?(h.$=s.$.get(h.soul),h.todo=[{it:h.data,ref:h.$}],h.turn=h.turn||o,h.ran=h.ran||u,function v(){var e,n,g,w,S,x=h.todo,T=x.pop(),A=T.it;if(T.ref&&T.ref._.id,r(h,T.ref),(w=T.todo)&&(A=A[n=w.pop()],w.length&&x.push(T)),n&&(x.path||(x.path=[])).push(n),!(e=a(A))&&!(S=t.is(A))){if(!Object.plain(A))return void u.err(h,"Invalid data: "+function(E,P){return E&&(P=E.constructor)&&P.name||typeof E}(A)+" at "+(h.via.back(function(E){E.get&&w.push(E.get)},w=[])||w.join("."))+"."+(x.path||[]).join("."));for(var D=h.seen||(h.seen=[]),C=D.length;C--;)if(A===(w=D[C]).it){e=A=w.link;break}}if(n&&e)T.node=i(T.node,n,c,A);else{let E=function(P,q){var M=g.link["#"];q&&(q.off(),q.rid(P));var J=M||P.soul||(w=(P.$$||P.$)._||"").soul||w.link||((w=w.put||"")._||"")["#"]||w["#"]||((w=P.put||"")&&P.$$?w["#"]:(w["="]||w[":"]||"")["#"]);M||r(h,P.$),J||T.link["#"]?(J||(J=[],(P.$$||P.$).back(function(I){if(w=I.soul||I.link)return J.push(w);J.push(I.get)}),J=J.reverse().join("/")),g.link["#"]=J,S||(((h.graph||(h.graph={}))[J]=g.node||(g.node={_:{}}))._["#"]=J),delete h.wait[O],g.wait&&setTimeout.each(g.wait,function(I){I&&I()}),h.ran(h)):(T.wait||(T.wait=[])).push(function(){E(P,q)})};var m=E;if(!h.seen)return void u.err(h,"Data at root of graph must be a node (an object).");h.seen.push(g={it:A,link:{},todo:S?[]:Object.keys(A).sort().reverse(),path:(x.path||[]).slice(),up:T}),T.node=i(T.node,n,c,g.link),!S&&g.todo.length&&x.push(g);var O=h.seen.length;(h.wait||(h.wait={}))[O]="",w=(g.ref=S?A:n?T.ref.get(n):T.ref)._,(w=A&&(A._||"")["#"]||w.soul||w.link)?E({soul:w}):g.ref.get(E,{run:h.run,v2020:1,out:{get:{".":" "}}})}if(!x.length)return h.ran(h);h.turn(v)}()):function(v){var e,n=v.via._;v.via=v.via.back(function(g){if(g.soul||!g.get)return g.$;e=v.data,(v.data={})[g.get]=e}),v.via&&v.via._.soul||(v.via=n.root.$.get(((v.data||"")._||"")["#"]||n.$.back("opt.uuid")())),v.via.put(v.data,v.ack,v)}(h),d},u.end=function(f,k){f.end=l,f.the.to===f&&f===f.the.last&&delete k.stun,f.off()},u.err=function(f,k){(f.ack||l).call(f,f.out={err:f.err=t.log(k)}),f.ran(f)};var l=function(){},o=setTimeout.turn,a=t.valid,i=t.state.ify})(b,"./put"),b(function($){var t=b("./root");b("./chain"),b("./back"),b("./put"),b("./get"),$.exports=t})(b,"./index"),b(function($){var t=b("./index");t.chain.on=function(r,u,l,o){var a,i=this._;if(i.root,typeof r=="string")return u?(a=i.on(r,u,l||i,o),l&&l.$&&(l.subs||(l.subs=[])).push(a),this):i.on(r);var f=u;return(f=f===!0?{change:!0}:f||{}).not=1,f.on=1,this.get(r,f),this},t.chain.once=function(r,u){if(u=u||{},!r)return function(f,k,h){return(h=f.chain())._.nix=f.once(function(d,y){h._.on("in",this._)}),h._.lex=f._.lex,h}(this);var l,o=this._,a=o.root,i=(o.put,String.random(7));return this.get(function(f,k,h,d){var y=this,s=y._,c=s.one||(s.one={});function v(e){s.has||s.soul||(s={put:f,get:k}),(l=s.put)===void 0&&(l=((h.$$||"")._||"").put),typeof t.valid(l)!="string"||(l=a.$.get(l)._.put)!==void 0||e?d.stun||c[i]!==""&&(c[i]="",(o.soul||o.has)&&d.off(),r.call(y,l,s.get),clearTimeout(c[i])):c[i]=setTimeout(function(){v(1)},u.wait||99)}d.stun||c[i]!==""&&((l=t.valid(f))!==!0?typeof l!="string"&&(clearTimeout((o.one||"")[i]),clearTimeout(c[i]),c[i]=setTimeout(v,u.wait||99)):v())},{on:1}),this},t.chain.off=function(){var r,u=this._,l=u.back;if(l)return u.ack=0,(r=l.next)&&r[u.get]&&delete r[u.get],(r=l.ask)&&delete r[u.get],(r=l.put)&&delete r[u.get],(r=u.soul)&&delete l.root.graph[r],(r=u.map)&&Object.keys(r).forEach(function(o,a){(a=r[o]).link&&l.root.$.get(a.link).off()}),(r=u.next)&&Object.keys(r).forEach(function(o,a){r[o].$.off()}),u.on("off",{}),this}})(b,"./on"),b(function($){var t=b("./index"),r=t.chain.get.next;function u(o){this.to.next(o);var a,i=this.as,f=o.$._,k=o.put;(f.soul||o.$$)&&((a=i.lex)&&!String.match(o.get||(k||"")["."],a["."]||a["#"]||a)||t.on.link(o,i))}t.chain.get.next=function(o,a){var i;return Object.plain(a)?(i=((i=a["#"])||"")["="]||i)?o.get(i):((i=o.chain()._).lex=a,o.on("in",function(f){String.match(f.get||(f.put||"")["."],a["."]||a["#"]||a)&&i.on("in",f),this.to.next(f)}),i.$):(r||l)(o,a)},t.chain.map=function(o,a,i){var f,k,h=this,d=h._;return Object.plain(o)&&(f=o["."]?o:{".":o},o=void 0),o?(k=h.chain(),h.map().on(function(y,s,c,v){var e=(o||l).call(this,y,s,c,v);if(e!==void 0){if(y===e)return k._.on("in",c);if(t.is(e))return k._.on("in",e._);var n={};Object.keys(c.put).forEach(function(g){n[g]=c.put[g]},n),n["="]=e,k._.on("in",{get:s,put:n})}})):(k=d.each)||((d.each=k=h.chain())._.lex=f||k._.lex||d.lex,k._.nix=h.back("nix"),h.on("in",u,k._)),k};var l=function(){}})(b,"./map"),b(function($){var t=b("./index");t.chain.set=function(r,u,l){var o,a,i=this,f=i.back(-1);return u=u||function(){},(l=l||{}).item=l.item||r,(o=((r||"")._||"")["#"])&&((r={})["#"]=o),typeof(a=t.valid(r))=="string"?i.get(o=a).put(r,u,l):t.is(r)?(i.put(function(k){r.get(function(h,d,y){if(!h)return u.call(i,{err:t.log('Only a node can be linked! Not "'+y.put+'"!')});(a={})[h]={"#":h},k(a)},!0)}),r):(Object.plain(r)&&(r=f.get(o=i.back("opt.uuid")()).put(r)),i.get(o||f.back("opt.uuid")(7)).put(r,u,l))}})(b,"./set"),b(function($){b("./shim");function t(){}var r=JSON.parseAsync||function(o,a,i){var f=+new Date;try{a(void 0,JSON.parse(o,i),u.sucks(+new Date-f))}catch(k){a(k)}},u=JSON.stringifyAsync||function(o,a,i,f){var k=+new Date;try{a(void 0,JSON.stringify(o,i,f),u.sucks(+new Date-k))}catch(h){a(h)}};u.sucks=function(o){99<o&&(u.sucks=t)};var l;try{$.exports=function(o){var a=function(){},i=o.opt||{};i.log=i.log||console.log,i.gap=i.gap||i.wait||0,i.max=i.max||.3*(i.memory?999*i.memory*999:3e8),i.pack=i.pack||.01*i.max*.01,i.puff=i.puff||9;var f=setTimeout.turn||setTimeout,k=o.dup,h=k.check,d=k.track,y=(new Date,a.hear=function(e,n){if(e){if(i.max<=e.length)return a.say({dam:"!",err:"Message too big!"},n);a===this&&(y.d+=e.length||0,++y.c);var g,w=n.SH=+new Date,S=e[0];return S==="["?(r(e,function(x,T){if(x||!T)return a.say({dam:"!",err:"DAM JSON parse error."},n);console.STAT&&console.STAT(+new Date,T.length,"# on hear batch");var A=i.puff;(function D(){for(var C,m=+new Date,O=0;O<A&&(C=T[O++]);)a.hear(C,n);T=T.slice(O),console.STAT&&console.STAT(m,+new Date-m,"hear loop"),s(n),T.length&&f(D,0)})()}),void(e="")):S==="{"||(e["#"]||Object.plain(e))&&(g=e)?g?y.one(g,n,w):void r(e,function(x,T){if(x||!T)return a.say({dam:"!",err:"DAM JSON parse error."},n);y.one(T,n,w)}):void 0}});function s(e){var n=e.batch,g=typeof n=="string";if(g&&(n+="]"),e.batch=e.tail=null,n&&(g?!(n.length<3):n.length)){if(!g)try{n=n.length===1?n[0]:JSON.stringify(n)}catch(w){return i.log("DAM JSON stringify error",w)}n&&c(n,e)}}function c(e,n){try{var g=n.wire;n.say?n.say(e):g.send&&g.send(e),a.say.d+=e.length||0,++a.say.c}catch{(n.queue=n.queue||[]).push(e)}}y.one=function(e,n,g){var w,S,x,T,A;if(e.DBG&&(e.DBG=A={DBG:e.DBG}),A&&(A.h=g),A&&(A.hp=+new Date),(w=e["#"])||(w=e["#"]=String.random(9)),!((x=h(w))||(S=e["##"])&&(x=e["@"]||e.get&&w)&&k.check(T=x+S))){if((e._=function(){}).via=a.leap=n,(x=e["><"])&&typeof x=="string"&&x.slice(0,99).split(",").forEach(function(D){this[D]=1},e._.yo={}),x=e.dam)return(x=a.hear[x])&&x(e,n,o),void d(w);g=+new Date,A&&(A.is=g),n.SI=w,o.on("in",a.last=e),A&&(A.hd=+new Date),console.STAT&&console.STAT(g,+new Date-g,e.get?"msg get":e.put?"msg put":"msg"),(x=d(w)).via=n,e.get&&(x.it=e),T&&d(T),a.leap=a.last=null}},y.c=y.d=0,function(){var e,n=0;function g(S,x){var T;return x instanceof Object?(Object.keys(x).sort().forEach(w,{to:T={},on:x}),T):x}function w(S){this.to[S]=this.on[S]}a.hash=function(S,x){var T,A,D,C=+new Date;u(S.put,function m(O,E){var P=(A=A||(D=E||"")).slice(0,32768);T=String.hash(P,T),(A=A.slice(32768))?f(m,0):(console.STAT&&console.STAT(C,+new Date-C,"say json+hash"),S._.$put=D,S["##"]=T,a.say(S,x),delete S._.$put)},g)},a.say=function(S,x){var T;if((T=this)&&(T=T.to)&&T.next&&T.next(S),!S)return!1;var A,D,C=S["@"],m=S._||(S._=function(){}),O=S.DBG,E=+new Date;if(m.y=m.y||E,x||O&&(O.y=E),(A=S["#"])||(A=S["#"]=String.random(9)),e||d(A),S.put&&(S.err||(k.s[A]||"").err))return!1;if(S["##"]||l===S.put||m.via||!C){if(!x&&C&&(x=(T=k.s[C])&&(T.via||(T=T.it)&&(T=T._)&&T.via)||(T=a.last)&&C===T["#"]&&a.leap),!x&&C)return k.s[C]?void 0:(console.STAT&&console.STAT(+new Date,++n,"total no peer to ack to"),!1);if(!x&&a.way)return a.way(S);if(O&&(O.yh=+new Date),D=m.raw){if(O&&(O.yr=+new Date),!x||!x.id){if(!Object.plain(x||i.peers))return!1;E=+new Date,i.puff;var P=i.peers,q=Object.keys(x||i.peers||{});return console.STAT&&console.STAT(E,+new Date-E,"peer keys"),void function J(){var I=+new Date;e=1;var K=m.raw;m.raw=D;for(var F,X=0;X<9&&(F=(q||"")[X++]);)(F=P[F])&&a.say(S,F);m.raw=K,e=0,q=q.slice(X),console.STAT&&console.STAT(I,+new Date-I,"say loop"),q.length&&(f(J,0),C&&d(C))}()}if(!x.wire&&a.wire&&a.wire(x),A!==x.last){if(x.last=A,x===m.via||(T=m.yo)&&(T[x.url]||T[x.pid]||T[x.id]))return!1;if(console.STAT&&console.STAT(E,((O||m).yp=+new Date)-(m.y||E),"say prep"),!e&&C&&d(C),x.batch){if(x.tail=(T=x.tail||0)+D.length,x.tail<=i.pack)return void(x.batch+=(T?",":"")+D);s(x)}x.batch="[";var M=+new Date;setTimeout(function(){console.STAT&&console.STAT(M,+new Date-M,"0ms TO"),s(x)},i.gap),c(D,x),console.STAT&&C===x.SI&&console.STAT(E,+new Date-x.SH,"say ack")}}else a.raw(S,x)}else a.hash(S,x)},a.say.c=a.say.d=0,a.raw=function(S,x){if(!S)return"";var T,A,D=S._||{};if(A=D.raw)return A;if(typeof S=="string")return S;var C=S["##"],m=S["@"];if(C&&m){if(!D.via&&h(m+C))return!1;if((A=(k.s[m]||"").it)||(A=a.last)&&m===A["#"]){if(C===A["##"])return!1;A["##"]||(A["##"]=C)}}if(!S.dam){var O=0,E=[];for(var P in A=i.peers){var q=A[P];if(E.push(q.url||q.pid||q.id),6<++O)break}1<O&&(S["><"]=E.join())}if(T=D.$put)return A={},Object.keys(S).forEach(function(J){A[J]=S[J]}),A.put=":])([:",void u(A,function(J,I){if(!J){var K=+new Date;A=I.indexOf('"put":":])([:"'),M(l,I=I.slice(0,A+6)+T+I.slice(A+14)),console.STAT&&console.STAT(K,+new Date-K,"say slice")}});function M(J,I){J||(D.raw=I,a.say(S,x))}u(S,M)}}(),a.hi=function(e){var n,g=e.wire;g?(e.id?i.peers[e.url||e.id]=e:(n=e.id=e.id||String.random(9),a.say({dam:"?",pid:o.opt.pid},i.peers[n]=e),delete k.s[e.last]),e.met=e.met||+new Date,g.hied||o.on(g.hied="hi",e),n=e.queue,e.queue=[],setTimeout.each(n||[],function(w){c(w,e)},0,9)):a.wire(e.length&&{url:e}||e)},a.bye=function(e){o.on("bye",e);var n=+new Date;n-=e.met||n,a.bye.time=((a.bye.time||n)+n)/2},a.hear["!"]=function(e,n){i.log("Error:",e.err)},a.hear["?"]=function(e,n){e.pid&&(n.pid||(n.pid=e.pid),e["@"])||(a.say({dam:"?",pid:i.pid,"@":e["#"]},n),delete k.s[n.last])},o.on("create",function(e){e.opt.pid=e.opt.pid||String.random(9),this.to.next(e),e.on("out",a.say)}),o.on("bye",function(e,n){e=i.peers[e.id||e]||e,this.to.next(e),e.bye?e.bye():(n=e.wire)&&n.close&&n.close(),delete i.peers[e.id],e.wire=null});var v={};return o.on("bye",function(e,n){this.to.next(e),(n=console.STAT)&&(n.peers=(n.peers||0)-1),(n=e.url)&&(v[n]=!0,setTimeout(function(){delete v[n]},i.lack||9e3))}),o.on("hi",function(e,n){this.to.next(e),(n=console.STAT)&&(n.peers=(n.peers||0)+1),(n=e.url)&&v[n]&&(delete v[n],i.super||setTimeout.each(Object.keys(o.next),function(g){o.next[g],(n={})[g]=o.graph[g],n=String.hash(n),a.say({"##":n,get:{"#":g}},e)}))}),a}}catch{}})(b,"./mesh"),b(function($){var t=b("../index");t.Mesh=b("./mesh"),t.on("opt",function(r){if(this.to.next(r),!r.once){var u=r.opt;if(u.WebSocket!==!1){var l=t.window||{},o=u.WebSocket||l.WebSocket||l.webkitWebSocket||l.mozWebSocket;if(o){u.WebSocket=o;var a=u.mesh=u.mesh||t.Mesh(r);a.wire||u.wire,a.wire=u.wire=k,setTimeout(function(){u.super||r.on("out",{dam:"hi"})},1);var i=1998,f=""+void 0!=typeof document&&document}}}function k(d){try{if(!d||!d.url)return s&&s(d);var y=d.url.replace(/^http/,"ws"),s=d.wire=new u.WebSocket(y);return s.onclose=function(){u.mesh.bye(d),h(d)},s.onerror=function(c){h(d)},s.onopen=function(){u.mesh.hi(d)},s.onmessage=function(c){c&&u.mesh.hear(c.data||c,d)},s}catch{}}function h(d){clearTimeout(d.defer),u.peers[d.url]&&(f&&d.retry<=0||(d.retry=(d.retry||u.retry+1||60)-(-d.tried+(d.tried=+new Date)<4*i?1:0),d.defer=setTimeout(function y(){if(f&&f.hidden)return setTimeout(y,i);k(d)},i)))}})})(b,"./websocket"),b(function($){if(typeof Database<"u"){var t;try{t=(Database.window||function(){}).localStorage}catch{}t||(t={setItem:function(u,l){this[u]=l},removeItem:function(u){delete this[u]},getItem:function(u){return this[u]}}),JSON.parseAsync;var r=JSON.stringifyAsync||function(u,l,o,a){try{l(void 0,JSON.stringify(u,o,a))}catch(i){l(i)}};Database.on("create",function u(l){this.to.next(l);var o,a,i,f,k=l.opt,h=(l.graph,[]);if(k.localStorage!==!1){k.prefix=k.file||"db/";try{o=u[k.prefix]=u[k.prefix]||JSON.parse(i=t.getItem(k.prefix))||{}}catch{o=u[k.prefix]={}}i=(i||"").length,l.on("get",function(y){this.to.next(y);var s,c,v,e=y.get;e&&(s=e["#"])&&((c=o[s]||void 0)&&(v=e["."])&&!Object.plain(v)&&(c=Database.state.ify({},v,Database.state.is(c,v),c[v],s)),Database.on.get.ack(y,c))}),l.on("put",function(y){this.to.next(y);var s=y.put,c=s["#"],v=s["."],e=y["#"];o[c]=Database.state.ify(o[c],v,s[">"],s[":"],c),f&&4999880<i?l.on("in",{"@":e,err:"localStorage max!"}):(y["@"]||h.push(e),a=a||setTimeout(d,9+i/333))})}function d(){if(h.length||!((setTimeout.turn||"").s||"").length){var y=h;clearTimeout(a),a=!1,h=[],r(o,function(s,c){try{s||t.setItem(k.prefix,c)}catch(v){s=f=v||"localStorage failure"}s&&l.on("localStorage:error",{err:s,get:k.prefix,put:o}),i=c.length,(s||Object.empty(k.peers))&&setTimeout.each(y,function(v){l.on("in",{"@":v,err:s,ok:0})},0,99)})}else setTimeout(d,99)}})}})(b,"./localStorage")})(),function(){if(""+w!=typeof Database){var b=function(p){},Y,$,t=Database;t.fn=t.fn||{is:function(p){return!!p&&typeof p=="function"}},t.bi=t.bi||{is:function(p){return p instanceof Boolean||typeof p=="boolean"}},t.num=t.num||{is:function(p){return!u(p)&&(0<=p-parseFloat(p)+1||1/0===p||-1/0===p)}},t.text=t.text||{is:function(p){return typeof p=="string"}},t.text.ify=t.text.ify||function(p){return t.text.is(p)?p:typeof JSON<"u"?JSON.stringify(p):p&&p.toString?p.toString():p},t.text.random=t.text.random||function(p,_){var j="";for(p=p||24,_=_||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<p;)j+=_.charAt(Math.floor(Math.random()*_.length)),p--;return j},t.text.match=t.text.match||function(p,_){var j,N;return typeof p=="string"&&(typeof _=="string"&&(_={"=":_}),p===(j=(_=_||{})["="]||_["*"]||_[">"]||_["<"])||N===_["="]&&(j=_["*"]||_[">"]||_["<"],p.slice(0,(j||"").length)===j||N===_["*"]&&(N!==_[">"]&&N!==_["<"]?p>=_[">"]&&p<=_["<"]:N!==_[">"]&&p>=_[">"]||N!==_["<"]&&p<=_["<"])))},t.text.hash=t.text.hash||function(p,_){if(typeof p=="string"){if(_=_||0,!p.length)return _;for(var j=0,N=p.length;j<N;++j)_=(_<<5)-_+p.charCodeAt(j),_|=0;return _}},t.list=t.list||{is:function(p){return p instanceof Array}},t.list.slit=t.list.slit||Array.prototype.slice,t.list.sort=t.list.sort||function(p){return function(_,j){return _&&j?(_=_[p])<(j=j[p])?-1:j<_?1:0:0}},t.list.map=t.list.map||function(p,_,j){return a(p,_,j)},t.list.index=1,t.obj=t.boj||{is:function(p){return!!p&&(p instanceof Object&&p.constructor===Object||Object.prototype.toString.call(p).match(/^\[object (\w+)\]$/)[1]==="Object")}},t.obj.put=t.obj.put||function(p,_,j){return(p||{})[_]=j,p},t.obj.has=t.obj.has||function(p,_){return p&&Object.prototype.hasOwnProperty.call(p,_)},t.obj.del=t.obj.del||function(p,_){if(p)return p[_]=null,delete p[_],p},t.obj.as=t.obj.as||function(p,_,j,N){return p[_]=p[_]||(N===j?{}:j)},t.obj.ify=t.obj.ify||function(p){if(l(p))return p;try{p=JSON.parse(p)}catch{p={}}return p},t.obj.to=t.obj.to||function(p,_){return a(p,D,_=_||{}),_},t.obj.copy=t.obj.copy||function(p){return p&&JSON.parse(JSON.stringify(p))},t.obj.empty=t.obj.empty||function(p,_){return!p||!a(p,C,{n:_})},$=Object.keys,Object.keys=Object.keys||function(p){return Y(p,function(_,j,N){N(j)})},t.obj.map=Y=t.obj.map||function(p,_,j){var N,U,R,L,et,Z=0,nt=typeof _=="function";if(m.r=N,$&&l(p)&&(L=$(p),et=!0),j=j||{},u(p)||L)for(U=(L||p).length;Z<U;Z++){var rt=Z+t.list.index;if(nt){if((R=et?_.call(j,p[L[Z]],L[Z],m):_.call(j,p[Z],rt,m))!==N)return R}else if(_===p[et?L[Z]:Z])return L?L[Z]:rt}else for(Z in p)if(nt){if(o(p,Z)&&(R=j?_.call(j,p[Z],Z,m):_(p[Z],Z,m))!==N)return R}else if(_===p[Z])return Z;return nt?m.r:t.list.index?0:-1},t.time=t.time||{},t.time.is=t.time.is||function(p){return p?p instanceof Date:+new Date().getTime()};var r=t.fn.is,u=t.list.is,l=(g=t.obj).is,o=g.has,a=g.map,i={is:function(p){return p!==w&&(p===null||p!==1/0&&(!!(d(p)||k(p)||h(p))||i.link.is(p)||!1))}};i.link=i.rel={_:"#"},i.link.is=function(p){if(p&&p[f]&&!p._&&l(p)){var _={};if(a(p,O,_),_.id)return _.id}return!1},i.link.ify=function(p){return y({},f,p)},t.obj.has._=".";var f=i.link._,k=t.bi.is,h=t.num.is,d=t.text.is,y=(l=(g=t.obj).is,g.put);a=g.map,t.val=t.val||i;var s={_:"_",soul:function(p,_){return p&&p._&&p._[_||e]}};s.soul.ify=function(p,_){return _=typeof _=="string"?{soul:_}:_||{},(p=p||{})._=p._||{},p._[e]=_.soul||p._[e]||v(),p},s.soul._=i.link._,s.is=function(p,_,j){var N;return!!l(p)&&!!(N=s.soul(p))&&!a(p,E,{as:j,cb:_,s:N,n:p})},s.ify=function(p,_,j){return _?typeof _=="string"?_={soul:_}:typeof _=="function"&&(_={map:_}):_={},_.map&&(_.node=_.map.call(j,p,w,_.node||{})),(_.node=s.soul.ify(_.node||{},_))&&a(p,P,{o:_,as:j}),_.node},l=(g=t.obj).is;var c=g.del,v=(a=g.map,t.text.random),e=s.soul._;t.node=t.node||s;var n=t.state;n.lex=function(){return n().toString(36).replace(".","")},n.to=function(p,_,j){var N=(p||{})[_];return l(N)&&(N=S(N)),n.ify(j,_,n.is(p,_),N,s.soul(p))},n.map=function(p,_,j){var N=l(N=p||_)?N:null;return p=r(p=p||_)?p:null,N&&!p?(_=h(_)?_:n(),N[x]=N[x]||{},a(N,q,{o:N,s:_}),N):(j=j||l(_)?_:void 0,_=h(_)?_:n(),function(U,R,L,et){if(!p)return q.call({o:L,s:_},U,R),U;p.call(j||this||{},U,R,L,et),o(L,R)&&L[R]===void 0||q.call({o:L,s:_},U,R)})},(g=t.obj).as,o=g.has,l=g.is,a=g.map;var g,w,S=g.copy,x=(h=t.num.is,r=t.fn.is,s._),T={is:function(p,_,j,N){return!(!p||!l(p)||A(p)||a(p,M,{cb:_,fn:j,as:N}))},ify:function(p,_,j){var N={path:[],obj:p};return _?typeof _=="string"?_={soul:_}:typeof _=="function"&&(_.map=_):_={},typeof j=="string"&&(_.soul=_.soul||j,j=w),_.soul&&(N.link=i.link.ify(_.soul)),_.shell=(j||{}).shell,_.graph=_.graph||{},_.seen=_.seen||[],_.as=_.as||j,I(_,N),_.root=N.node,_.graph},node:function(p){var _=s.soul(p);if(_)return y({},_,p)},to:function(p,_,j){if(p){var N={};return j=j||{seen:{}},a(p[_],tt,{obj:N,graph:p,opt:j}),N}}},A=(r=t.fn.is,l=(g=t.obj).is,c=g.del,o=g.has,g.empty);y=g.put,a=g.map,S=g.copy,t.graph=t.graph||T}function D(B,p){o(this,p)&&this[p]!==void 0||(this[p]=B)}function C(B,p){var _=this.n;if(!_||!(p===_||l(_)&&o(_,p)))return p!==void 0||void 0}function m(B,p){arguments.length!==2?(m.r=m.r||[]).push(B):(m.r=m.r||{})[B]=p}function O(B,p){return this.id?this.id=!1:p==f&&d(B)?void(this.id=B):this.id=!1}function E(B,p){if(p!==s._)return!i.is(B)||void(this.cb&&this.cb.call(this.as,B,p,this.n,this.s))}function P(B,p){var _,j=this.o;j.map?(_=j.map.call(this.as,B,""+p,j.node))===void 0?c(j.node,p):j.node&&(j.node[p]=_):i.is(B)&&(j.node[p]=B)}function q(B,p){x!==p&&n.ify(this.o,p,this.s)}function M(B,p){if(!B||p!==s.soul(B)||!s.is(B,this.fn,this.as))return!0;this.cb&&(J.n=B,J.as=this.as,this.cb.call(J.as,B,p,J))}function J(B){B&&s.is(J.n,B,J.as)}function I(B,p){var _;return(_=function(j,N){for(var U,R=j.seen,L=R.length;L--;)if(U=R[L],N.obj===U.obj)return U;R.push(N)}(B,p))?_:(p.env=B,p.soul=F,s.ify(p.obj,K,p)&&(p.link=p.link||i.link.ify(s.soul(p.node)),p.obj!==B.shell&&(B.graph[i.link.is(p.link)]=p.node)),p)}function K(B,p,_){var j,N,U=this,R=U.env;if(s._===p&&o(B,i.link._))return _._;if(j=X(B,p,_,U,R)){if(p||(U.node=U.node||_||{},o(B,s._)&&s.soul(B)&&(U.node._=S(B._)),U.node=s.soul.ify(U.node,i.link.is(U.link)),U.link=U.link||i.link.ify(s.soul(U.node))),(N=R.map)&&(N.call(R.as||{},B,p,_,U),o(_,p))){if(B=_[p],w===B)return void c(_,p);if(!(j=X(B,p,_,U,R)))return}if(!p)return U.node;if(j===!0)return B;if((N=I(R,{obj:B,path:U.path.concat(p)})).node)return N.link}}function F(B){var p=this,_=i.link.is(p.link),j=p.env.graph;p.link=p.link||i.link.ify(B),p.link[i.link._]=B,p.node&&p.node[s._]&&(p.node[s._][i.link._]=B),o(j,_)&&(j[B]=j[_],c(j,_))}function X(B,p,_,j,N){var U;return!!i.is(B)||(l(B)?1:(U=N.invalid)?X(B=U.call(N.as||{},B,p,_),p,_,j,N):(N.err="Invalid value at '"+j.path.concat(p).join(".")+"'!",void(t.list.is(B)&&(N.err+=" Use `.set(item)` instead of an Array."))))}function tt(B,p){var _,j;if(s._!==p)(_=i.link.is(B))?(j=this.opt.seen[_])?this.obj[p]=j:this.obj[p]=this.opt.seen[_]=T.to(this.graph,_,this.opt):this.obj[p]=B;else{if(A(B,i.link._))return;this.obj[p]=S(B)}}}()});W()})();(()=>{var V=(G=>typeof Q<"u"?Q:typeof Proxy<"u"?new Proxy(G,{get:(H,b)=>(typeof Q<"u"?Q:H)[b]}):G)(function(G){if(typeof Q<"u")return Q.apply(this,arguments);throw new Error('Dynamic require of "'+G+'" is not supported')}),z=(G,H)=>()=>(H||G((H={exports:{}}).exports,H),H.exports),W=z((G,H)=>{(function(){function b($,t){return t?V($):$.slice?b[r($)]:function(u,l){$(u={exports:{}}),b[r(l)]=u.exports};function r(u){return u.split("/").slice(-1).toString().replace(".js","")}}var Y;typeof H<"u"&&(Y=H),b(function($){typeof window<"u"&&($.window=window);var t=($.window||$).SEA||{};(t.window=$.window)&&(t.window.SEA=t);try{void 0+""!=typeof Y&&(Y.exports=t)}catch{}$.exports=t})(b,"./root"),b(function($){var t=b("./root");try{t.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTP is not supported. Redirecting to HTTPS..."),location.protocol="https:")}catch{}})(b,"./https"),b(function($){var t;if(t+""==typeof btoa){if(t+""==typeof Buffer)try{global.Buffer=b("buffer",1).Buffer}catch{}global.btoa=function(r){return Buffer.from(r,"binary").toString("base64")},global.atob=function(r){return Buffer.from(r,"base64").toString("binary")}}})(b,"./base64"),b(function($){function t(){}b("./base64"),Object.assign(t,{from:Array.from}),(t.prototype=Object.create(Array.prototype)).toString=function(r,u,l){u=u||0;var o=this.length;if((r=r||"utf8")!=="hex")return r==="utf8"?Array.from({length:(l||o)-u},(a,i)=>String.fromCharCode(this[i+u])).join(""):r==="base64"?btoa(this):void 0;{let a=new Uint8Array(this);return[...Array((l&&l+1||o)-u).keys()].map(i=>a[i+u].toString(16).padStart(2,"0")).join("")}},$.exports=t})(b,"./array"),b(function($){b("./base64");var t=b("./array");function r(...u){return r.from(...u)}r.prototype=Object.create(Array.prototype),Object.assign(r,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");let u=arguments[0],l;if(typeof u=="string"){var o=arguments[1]||"utf8";if(o==="hex"){var a=u.match(/([\da-fA-F]{2})/g).map(i=>parseInt(i,16));if(!a||!a.length)throw new TypeError("Invalid first argument for type 'hex'.");l=t.from(a)}else if(o==="utf8"||o==="binary"){let i=u.length,f=new Uint16Array(i);Array.from({length:i},(k,h)=>f[h]=u.charCodeAt(h)),l=t.from(f)}else if(o==="base64"){let i=atob(u),f=i.length,k=new Uint8Array(f);Array.from({length:f},(h,d)=>k[d]=i.charCodeAt(d)),l=t.from(k)}else o==="binary"?l=t.from(u):console.info("SafeBuffer.from unknown encoding: "+o);return l}if(u.byteLength,u.byteLength||u.length){let i;return u instanceof ArrayBuffer&&(i=new Uint8Array(u)),t.from(i||u)}},alloc(u,l=0){return t.from(new Uint8Array(Array.from({length:u},()=>l)))},allocUnsafe(u){return t.from(new Uint8Array(Array.from({length:u})))},concat(u){if(Array.isArray(u))return t.from(u.reduce((l,o)=>l.concat(Array.from(o)),[]));throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.")}}),r.prototype.from=r.from,r.prototype.toString=t.prototype.toString,$.exports=r})(b,"./buffer"),b(function($){var t=b("./root");let r={Buffer:b("./buffer")};var u={};if(JSON.parseAsync=JSON.parseAsync||function(o,a,i){try{a(void 0,JSON.parse(o,i))}catch(f){a(f)}},JSON.stringifyAsync=JSON.stringifyAsync||function(o,a,i,f){try{a(void 0,JSON.stringify(o,i,f))}catch(k){a(k)}},r.parse=function(o,a){return new Promise(function(i,f){JSON.parseAsync(o,function(k,h){k?f(k):i(h)},a)})},r.stringify=function(o,a,i){return new Promise(function(f,k){JSON.stringifyAsync(o,function(h,d){h?k(h):f(d)},a,i)})},t.window&&(r.crypto=window.crypto||window.msCrypto,r.subtle=(r.crypto||u).subtle||(r.crypto||u).webkitSubtle,r.TextEncoder=window.TextEncoder,r.TextDecoder=window.TextDecoder,r.random=o=>r.Buffer.from(r.crypto.getRandomValues(new Uint8Array(r.Buffer.alloc(o))))),r.TextDecoder||({TextEncoder:t,TextDecoder:u}=b((void 0+""==typeof Y?".":"")+"./lib/text-encoding",1),r.TextDecoder=u,r.TextEncoder=t),!r.crypto)try{var l=b("crypto",1);Object.assign(r,{crypto:l,random:a=>r.Buffer.from(l.randomBytes(a))});let o=b("@peculiar/webcrypto",1).Crypto;r.ossl=r.subtle=new o({directory:"ossl"}).subtle}catch{}$.exports=r})(b,"./shim"),b(function($){var t=b("./root"),r=b("./shim"),u={pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(l,o){return l={kty:"EC",crv:"P-256",x:(l=l.split("."))[0],y:l[1],ext:!0},l.key_ops=o?["sign"]:["verify"],o&&(l.d=o),l},keyToJwk:function(l){let o=l.toString("base64");return{kty:"oct",k:o.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(l){return l}},check:function(l){return typeof l=="string"&&l.slice(0,4)==="SEA{"},parse:async function(l){try{var o=typeof l=="string";return o&&l.slice(0,4)==="SEA{"&&(l=l.slice(3)),o?await r.parse(l):l}catch{}return l}};t.opt=u,$.exports=u})(b,"./settings"),b(function($){var t=b("./shim");$.exports=async function(r,u){return r=typeof r=="string"?r:await t.stringify(r),u=await t.subtle.digest({name:u||"SHA-256"},new t.TextEncoder().encode(r)),t.Buffer.from(u)}})(b,"./sha256"),b(function($){var t=b("./shim"),r=t.subtle;let u=t.ossl||r;$.exports=l=>u.digest({name:"SHA-1"},new ArrayBuffer(l))})(b,"./sha1"),b(function($){var t=b("./root"),r=b("./shim"),u=b("./settings"),l=b("./sha256");t.work=t.work||(async(o,a,i,f)=>{try{var h=(a||{}).epub||a;if(f=f||{},h instanceof Function&&(i=h,h=void 0),o=typeof o=="string"?o:await r.stringify(o),(f.name||"").toLowerCase().slice(0,3)==="sha"){var k=r.Buffer.from(await l(o,f.name),"binary").toString(f.encode||"base64");if(i)try{i(k)}catch(c){console.log(c)}return k}var h=h||r.random(9),d=await(r.ossl||r.subtle).importKey("raw",new r.TextEncoder().encode(o),{name:f.name||"PBKDF2"},!1,["deriveBits"]),y=await(r.ossl||r.subtle).deriveBits({name:f.name||"PBKDF2",iterations:f.iterations||u.pbkdf2.iter,salt:new r.TextEncoder().encode(f.salt||h),hash:f.hash||u.pbkdf2.hash},d,f.length||8*u.pbkdf2.ks),s=(o=r.random(o.length),r.Buffer.from(y,"binary").toString(f.encode||"base64"));if(i)try{i(s)}catch(c){console.log(c)}return s}catch(c){if(console.log(c),t.err=c,t.throw)throw c;return void(i&&i())}}),$.exports=t.work})(b,"./work"),b(function($){var t=b("./root"),r=b("./shim");b("./settings"),t.name=t.name||(async(u,l)=>{try{if(u)try{u()}catch(o){console.log(o)}return}catch(o){if(console.log(o),t.err=o,t.throw)throw o;return void(u&&u())}}),t.pair=t.pair||(async(u,l)=>{try{var o=r.ossl||r.subtle,a=await r.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async d=>{var h={},d=(h.priv=(await r.subtle.exportKey("jwk",d.privateKey)).d,await r.subtle.exportKey("jwk",d.publicKey));return h.pub=d.x+"."+d.y,h});try{var i=await o.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async y=>{var d={},y=(d.epriv=(await o.exportKey("jwk",y.privateKey)).d,await o.exportKey("jwk",y.publicKey));return d.epub=y.x+"."+y.y,d})}catch(k){if(t.window||k!="Error: ECDH is not a supported algorithm")throw k;console.log("Ignoring ECDH...")}var i=i||{},f={pub:a.pub,priv:a.priv,epub:i.epub,epriv:i.epriv};if(u)try{u(f)}catch(k){console.log(k)}return f}catch(k){if(console.log(k),t.err=k,t.throw)throw k;return void(u&&u())}}),$.exports=t.pair})(b,"./pair"),b(function($){var t=b("./root"),r=b("./shim"),u=b("./settings"),l=b("./sha256");t.sign=t.sign||(async(o,a,i,f)=>{try{if(f=f||{},!(a||f).priv){if(!t.I)throw"No signing key.";a=await t.I(null,{what:o,how:"sign",why:f.why})}if(o===void 0)throw"`undefined` not allowed.";var k=await u.parse(o),h=f.check=f.check||k;if(t.verify&&(t.opt.check(h)||h&&h.s&&h.m)&&await t.verify(h,a)!==void 0){var e=await u.parse(h);if(f.raw||(e="SEA"+await r.stringify(e)),i)try{i(e)}catch(g){console.log(g)}return e}var d=a.pub,y=a.priv,s=u.jwk(d,y),c=await l(k),v=await(r.ossl||r.subtle).importKey("jwk",s,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(n=>(r.ossl||r.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},n,new Uint8Array(c))),e={m:k,s:r.Buffer.from(v,"binary").toString(f.encode||"base64")};if(f.raw||(e="SEA"+await r.stringify(e)),i)try{i(e)}catch(n){console.log(n)}return e}catch(n){if(console.log(n),t.err=n,t.throw)throw n;return void(i&&i())}}),$.exports=t.sign})(b,"./sign"),b(function($){var t=b("./root"),r=b("./shim"),u=b("./settings"),l=b("./sha256"),o=(t.verify=t.verify||(async(i,f,k,h)=>{try{var d=await u.parse(i);if(f===!1){var y=await u.parse(d.m);if(k)try{k(y)}catch(S){console.log(S)}return y}h=h||{};var s,c,v,e=f.pub||f,n=t.opt.slow_leak?await t.opt.slow_leak(e):await(r.ossl||r.subtle).importKey("jwk",u.jwk(e),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),g=await l(d.m);try{if(s=r.Buffer.from(d.s,h.encode||"base64"),c=new Uint8Array(s),!(v=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,c,new Uint8Array(g))))throw"Signature did not match."}catch{if(t.opt.fallback)return await t.opt.fall_verify(i,f,k,h)}var w=v?await u.parse(d.m):void 0;if(k)try{k(w)}catch(S){console.log(S)}return w}catch(S){if(console.log(S),t.err=S,t.throw)throw S;return void(k&&k())}}),$.exports=t.verify,{}),a=(t.opt.slow_leak=i=>{if(o[i])return o[i];var f=u.jwk(i);return o[i]=(r.ossl||r.subtle).importKey("jwk",f,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),o[i]},t.opt);t.opt.fall_verify=async function(i,n,k,h,g){if(g===t.opt.fallback)throw"Signature did not match";g=g||1;var y,s,c,v=i||"",e=(i=t.opt.unpack(i)||i,await u.parse(i)),n=n.pub||n,n=await t.opt.slow_leak(n),g=g<=t.opt.fallback?r.Buffer.from(await r.subtle.digest({name:"SHA-256"},new r.TextEncoder().encode(await u.parse(e.m)))):await l(e.m);try{if(y=r.Buffer.from(e.s,h.encode||"base64"),s=new Uint8Array(y),!(c=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,s,new Uint8Array(g))))throw"Signature did not match."}catch{try{y=r.Buffer.from(e.s,"utf8"),s=new Uint8Array(y),c=await(r.ossl||r.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},n,s,new Uint8Array(g))}catch{if(!c)throw"Signature did not match."}}if(h=c?await u.parse(e.m):void 0,a.fall_soul=v["#"],a.fall_key=v["."],a.fall_val=i,a.fall_state=v[">"],k)try{k(h)}catch(w){console.log(w)}return h},t.opt.fallback=2})(b,"./verify"),b(function($){var t=b("./shim"),r=b("./settings"),u=b("./sha256");$.exports=async(l,o,a)=>(l+=(o||t.random(8)).toString("utf8"),o=t.Buffer.from(await u(l),"binary"),l=r.keyToJwk(o),t.subtle.importKey("jwk",l,{name:"AES-GCM"},!1,["encrypt","decrypt"]))})(b,"./aeskey"),b(function($){var t=b("./root"),r=b("./shim"),u=(b("./settings"),b("./aeskey"));t.encrypt=t.encrypt||(async(l,o,a,i)=>{try{i=i||{};var f=(o||i).epriv||o;if(l===void 0)throw"`undefined` not allowed.";if(!f){if(!t.I)throw"No encryption key.";f=(o=await t.I(null,{what:l,how:"encrypt",why:i.why})).epriv||o}var k=typeof l=="string"?l:await r.stringify(l),h={s:r.random(9),iv:r.random(15)},d=await u(f,h.s,i).then(s=>r.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(h.iv)},s,new r.TextEncoder().encode(k))),y={ct:r.Buffer.from(d,"binary").toString(i.encode||"base64"),iv:h.iv.toString(i.encode||"base64"),s:h.s.toString(i.encode||"base64")};if(i.raw||(y="SEA"+await r.stringify(y)),a)try{a(y)}catch(s){console.log(s)}return y}catch(s){if(console.log(s),t.err=s,t.throw)throw s;return void(a&&a())}}),$.exports=t.encrypt})(b,"./encrypt"),b(function($){var t=b("./root"),r=b("./shim"),u=b("./settings"),l=b("./aeskey");t.decrypt=t.decrypt||(async(o,a,i,f)=>{try{f=f||{};var k=(a||f).epriv||a;if(!k){if(!t.I)throw"No decryption key.";k=(a=await t.I(null,{what:o,how:"decrypt",why:f.why})).epriv||a}var h=await u.parse(o);try{var d=r.Buffer.from(h.s,f.encode||"base64"),y=r.Buffer.from(h.iv,f.encode||"base64"),s=r.Buffer.from(h.ct,f.encode||"base64"),c=await l(k,d,f).then(e=>r.subtle.decrypt({name:f.name||"AES-GCM",iv:new Uint8Array(y),tagLength:128},e,new Uint8Array(s)))}catch{if(f.encode==="utf8")throw"Could not decrypt";if(t.opt.fallback)return f.encode="utf8",await t.decrypt(o,a,i,f)}var v=await u.parse(new r.TextDecoder("utf8").decode(c));if(i)try{i(v)}catch(e){console.log(e)}return v}catch(e){if(console.log(e),t.err=e,t.throw)throw e;return void(i&&i())}}),$.exports=t.decrypt})(b,"./decrypt"),b(function($){var t=b("./root"),r=b("./shim"),u=(b("./settings"),t.secret=t.secret||(async(l,o,a,i)=>{try{if(i=i||{},!o||!o.epriv||!o.epub){if(!t.I)throw"No secret mix.";o=await t.I(null,{what:l,how:"secret",why:i.why})}var f=l.epub||l,k=o.epub,h=o.epriv,d=r.ossl||r.subtle,y=u(f),s=Object.assign({public:await d.importKey(...y,!0,[])},{name:"ECDH",namedCurve:"P-256"}),c=u(k,h),v=await d.importKey(...c,!1,["deriveBits"]).then(async e=>(e=await d.deriveBits(s,e,256),e=new Uint8Array(e),e=await d.importKey("raw",e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),d.exportKey("jwk",e).then(({k:n})=>n)));if(a)try{a(v)}catch(e){console.log(e)}return v}catch(e){if(console.log(e),t.err=e,t.throw)throw e;return void(a&&a())}}),(a,o)=>{var[a,i]=a.split(".");return["jwk",Object.assign(o?{d:o}:{},{x:a,y:i,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]});$.exports=t.secret})(b,"./secret"),b(function($){var t=b("./root");t.certify=t.certify||(async(r,u={},l,o,a={})=>{try{if(!(r=(()=>{var v=[];if(r){if((typeof r=="string"||Array.isArray(r))&&-1<r.indexOf("*"))return"*";if(typeof r=="string")return r;if(Array.isArray(r)){if(r.length===1&&r[0])return typeof r[0]=="object"&&r[0].pub?r[0].pub:typeof r[0]=="string"?r[0]:null;r.map(e=>{typeof e=="string"?v.push(e):typeof e=="object"&&e.pub&&v.push(e.pub)})}return typeof r=="object"&&r.pub?r.pub:0<v.length?v:null}})()))return console.log("No certificant found.");var i=!a.expiry||typeof a.expiry!="number"&&typeof a.expiry!="string"?null:parseFloat(a.expiry),f=(u||{}).read?u.read:null,k=(u||{}).write?u.write:typeof u=="string"||Array.isArray(u)||u["+"]||u["#"]||u["."]||u["="]||u["*"]||u[">"]||u["<"]?u:null,h=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},d=h.read&&(typeof h.read=="string"||(h.read||{})["#"])?h.read:null,y=typeof h=="string"?h:h.write&&(typeof h.write=="string"||h.write["#"])?h.write:null;if(!f&&!k)return console.log("No policy found.");var s=JSON.stringify({c:r,...i?{e:i}:{},...f?{r:f}:{},...k?{w:k}:{},...d?{rb:d}:{},...y?{wb:y}:{}}),c=await t.sign(s,l,null,{raw:1});if(a.raw||(c="SEA"+JSON.stringify(c)),o)try{o(c)}catch(v){console.log(v)}return c}catch(v){if(t.err=v,t.throw)throw v;return void(o&&o())}}),$.exports=t.certify})(b,"./certify"),b(function($){var t=b("./shim"),r=b("./root");r.work=b("./work"),r.sign=b("./sign"),r.verify=b("./verify"),r.encrypt=b("./encrypt"),r.decrypt=b("./decrypt"),r.certify=b("./certify"),r.random=r.random||t.random,r.Buffer=r.Buffer||b("./buffer"),r.keyid=r.keyid||(async u=>{try{var l=t.Buffer.concat(u.replace(/-/g,"+").replace(/_/g,"/").split(".").map(f=>t.Buffer.from(f,"base64"))),o=t.Buffer.concat([t.Buffer.from([153,l.length/256,l.length%256]),l]),a=await sha1hash(o);let i=t.Buffer.from(a,"binary");return i.toString("hex",i.length-8)}catch(i){throw console.log(i),i}}),((r.window||{}).Database||{}).SEA=r,$.exports=r})(b,"./sea"),b(function($){var t,r=b("./sea");function u(a){this._={$:this}}function l(){}function o(){return t.state().toString(36).replace(".","")}t=r.window.Database,r.Database=t,l.prototype=t.chain,(u.prototype=new l).constructor=u,t.chain.user=function(a){var i=this.back(-1);if(a)return a=r.opt.pub((a._||"")["#"])||a,i.get("~"+a);if(a=i.back("user"))return a;var f=i=i._,k=f.opt.uuid||o;return(f=(a=f.user=this.chain(new u))._).opt={},f.opt.uuid=function(h){var d=k(),y=i.user;return(y=y&&y.is)&&(y=y.pub)&&(d="~"+y+"/"+d,h&&h.call&&h(null,d)),d},a},(t.User=u).Database=t,u.SEA=t.SEA=r,$.exports=u})(b,"./user"),b(function($){window.Database.chain.then=function(t,r){var u=this,l=new Promise(function(o,a){u.once(o,r)});return t?l.then(t):l}})(b,"./then"),b(function($){var t=b("./user"),r=t.SEA,u=t.Database,l=function(){};t.prototype.create=function(...o){var a,i=typeof o[0]=="object"&&(o[0].pub||o[0].epub)?o[0]:typeof o[1]=="object"&&(o[1].pub||o[1].epub)?o[1]:null,f=i&&(i.pub||i.epub)?i.pub:typeof o[0]=="string"?o[0]:null,k=i&&(i.pub||i.epub)?i:f&&typeof o[1]=="string"?o[1]:null,s=o.filter(e=>typeof e=="function")[0]||null,c=o&&1<o.length&&typeof o[o.length-1]=="object"?o[o.length-1]:{},h=this,d=h._,y=h.back(-1),s=s||l,c=c||{};if(c.check!==!1&&(f||(a="No user."),a=(k||"").length<8?"Password is too short":a))return s({err:u.log(a)}),h;if(d.ing)return(s||l)({err:u.log("User is already being created or authenticated!"),wait:!0}),h;d.ing=!0;var v={a:function(e){if((v.pubs=e)&&!c.already)return e={err:u.log("User already created!")},d.ing=!1,(s||l)(e),void h.leave();v.salt=String.random(64),r.work(k,v.salt,v.b)},b:function(e){v.proof=e,i?v.c(i):r.pair(v.c)},c:function(e){var n;v.pair=e||{},(n=d.root.user)&&(n._.sea=e,n.is={pub:e.pub,epub:e.epub,alias:f}),v.data={pub:e.pub},v.d()},d:function(){v.data.alias=f,v.e()},e:function(){v.data.epub=v.pair.epub,r.encrypt({priv:v.pair.priv,epriv:v.pair.epriv},v.proof,v.f,{raw:1})},f:function(e){v.data.auth=JSON.stringify({ek:e,s:v.salt}),v.g(v.data.auth)},g:function(e){v.data.auth=v.data.auth||e,y.get(e="~"+v.pair.pub).put(v.data).on(v.h);var n={};n[e]={"#":e},y.get("~@"+f).put(n).get(e).on(v.i)},h:function(e,n,g,w){w.off(),v.h.ok=1,v.i()},i:function(e,n,g,w){w&&(v.i.ok=1,w.off()),v.h.ok&&v.i.ok&&(d.ing=!1,s({ok:0,pub:v.pair.pub}),l===s&&(i?h.auth(i):h.auth(f,k)))}};return y.get("~@"+f).once(v.a),h},t.prototype.leave=function(o,a){var i=this.back(-1)._.user;if(i&&(delete i.is,delete i._.is,delete i._.sea),r.window)try{var f={};delete(f=window.sessionStorage).recall,delete f.pair}catch{}return this}})(b,"./create"),b(function($){var t=b("./user"),r=t.SEA,u=t.Database,l=function(){};function o(a){if(typeof a!="string")return a;try{a=JSON.parse(a)}catch{a={}}return a}t.prototype.auth=function(...a){var i=typeof a[0]=="object"&&(a[0].pub||a[0].epub)?a[0]:typeof a[1]=="object"&&(a[1].pub||a[1].epub)?a[1]:null,f=i||typeof a[0]!="string"?null:a[0],k=f&&typeof a[1]=="string"?a[1]:null,h=a.filter(n=>typeof n=="function")[0]||null,d=a&&1<a.length&&typeof a[a.length-1]=="object"?a[a.length-1]:{},y=this,s=y._,c=y.back(-1);if(s.ing)return(h||l)({err:u.log("User is already being created or authenticated!"),wait:!0}),y;s.ing=!0;var v,e={a:function(n){return n?n.pub?e.name?e.f(n):void e.c((e.data=n).auth):(g=[],Object.keys(n).forEach(function(w){w!="_"&&g.push(n[w])}),e.b(g)):e.b();var g},b:function(n){if(n=(e.list=(e.list||[]).concat(n||[])).shift(),v===n)return e.name?e.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):e.err("Wrong user or password.");c.get(n).once(e.a)},c:function(n){return v===n?e.b():typeof n=="string"?e.c(o(n)):void r.work(k,(e.auth=n).s,e.d,e.enc)},d:function(n){r.decrypt(e.auth.ek,n,e.e,e.enc)},e:function(n){if(v===n)return e.enc?(e.enc=null,e.b()):(e.enc={encode:"utf8"},e.c(e.auth));e.half=n,e.f(e.data)},f:function(n){var g=e.half||{},w=e.data||{};e.g(e.lol={pub:n.pub||w.pub,epub:n.epub||w.epub,priv:n.priv||g.priv,epriv:n.epriv||g.epriv})},g:function(n){if(!n||!n.pub||!n.epub)return e.b();e.pair=n;var g=c._.user,w=g._,S=(w.tag,w.opt);(w=g._=c.get("~"+n.pub)._).opt=S,g.is={pub:n.pub,epub:n.epub,alias:f||n.pub},w.sea=e.pair,s.ing=!1;try{k&&v==(o(s.root.graph["~"+n.pub].auth)||"")[":"]&&(d.shuffle=d.change=k)}catch{}if(d.change?e.z():(h||l)(w),r.window&&(y.back("user")._.opt||d).remember)try{var x={};(x=window.sessionStorage).recall=!0,x.pair=JSON.stringify(n)}catch{}try{c._.tag.auth?c._.on("auth",w):setTimeout(function(){c._.on("auth",w)},1)}catch(T){u.log("Your 'auth' callback crashed with:",T)}},z:function(){e.salt=String.random(64),r.work(d.change,e.salt,e.y)},y:function(n){r.encrypt({priv:e.pair.priv,epriv:e.pair.epriv},n,e.x,{raw:1})},x:function(n){e.w(JSON.stringify({ek:n,s:e.salt}))},w:function(n){var g;d.shuffle&&(g={},Object.keys(e.data).forEach(function(w){g[w]=e.data[w]}),delete g._,g.auth=n,c.get("~"+e.pair.pub).put(g)),c.get("~"+e.pair.pub).get("auth").put(n,h||l)},err:function(n){n={err:u.log(n||"User cannot be found!")},s.ing=!1,(h||l)(n)},plugin:function(n){if(!(e.name=n))return e.err();var g=[n];n[0]!=="~"&&(g[1]="~"+n,g[2]="~@"+n),e.b(g)}};return i?e.g(i):f?c.get("~@"+f).once(e.a):k||r.name(e.plugin),y}})(b,"./auth"),b(function($){var t=b("./user"),r=t.SEA;t.Database,t.prototype.recall=function(u,l){var o=this.back(-1);if((u=u||{})&&u.sessionStorage){if(r.window)try{var a;(a=window.sessionStorage)&&(o._.opt.remember=!0,(this.back("user")._.opt||u).remember=!0,(a.recall||a.pair)&&o.user().auth(JSON.parse(a.pair),l))}catch{}return this}return this}})(b,"./recall"),b(function($){var t=b("./user"),r=t.SEA,u=t.Database;t.prototype.pair=function(){var l,o=this;try{l=new Proxy({DANGER:"\u2620"},{get:function(a,i,f){if(o.is&&(o._||"").sea)return o._.sea[i]}})}catch{}return l},t.prototype.delete=async function(l,o,a){this.back(-1);var i=this.back("user");try{i.auth(l,o,function(f){(i.is||{}).pub,i.map().once(function(){this.put(null)}),i.leave(),(a||function(){})({ok:0})})}catch(f){u.log("User.delete failed! Error:",f)}return this},t.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");var l=this.back(-1);try{return await authRecall(l),l._.user._}catch{throw l="No session!",u.log(l),{err:l}}},t.prototype.trust=async function(l){u.is(l)&&l.get("pub").get((o,a)=>{console.log(o,a)}),l.get("trust").get(path).put(theirPubkey)},t.prototype.grant=function(l,o){var a=this.back(-1).user(),i=a._.sea,f="";return this.back(function(k){k.is||(f+=k.get||"")}),async function(){var k=await a.get("grant").get(i.pub).get(f).then(),h=((k=await r.decrypt(k,i))||(k=r.random(16).toString(),y=await r.encrypt(k,i),a.get("grant").get(i.pub).get(f).put(y)),l.get("pub").then()),d=l.get("epub").then(),h=await h,d=await d,d=await r.secret(d,i),y=await r.encrypt(k,d);a.get("grant").get(h).get(f).put(y,o)}(),this},t.prototype.secret=function(l,o){var a=this,i=a.back(-1).user(),f=i.pair(),k="";return a.back(function(h){h.is||(k+=h.get||"")}),async function(){var h,d=await i.get("trust").get(f.pub).get(k).then();(d=await r.decrypt(d,f))||(d=r.random(16).toString(),h=await r.encrypt(d,f),i.get("trust").get(f.pub).get(k).put(h)),h=await r.encrypt(l,d),a.put(h,o)}(),a},$.exports=t})(b,"./share"),b(function($){var t,r=b("./sea"),u=b("./settings"),l=window.Database;function o(d){var y,s,c=this,v=c.as,e=d.put,n=e["#"],g=e["."],w=e[":"],S=e[">"],x=d["#"];n&&g&&((d._||"").faith&&(v.opt||"").faith&&typeof d._=="function"?r.opt.pack(e,function(T){r.verify(T,!1,function(A){e["="]=r.opt.unpack(A),c.to.next(d)})}):(s=function(T){v.on("in",{"@":x,err:d.err=T})},(d._||"").DBG&&((d._||"").DBG.c=+new Date),0<=n.indexOf("<?")&&(y=parseFloat(n.split("<?")[1]||""))&&S<l.state()-1e3*y?(y=d._)&&y.stun&&y.stun--:n==="~@"?o.alias(c,d,w,g,n,v,s):n.slice(0,2)==="~@"?o.pubs(c,d,w,g,n,v,s):(y=r.opt.pub(n))?o.pub(c,d,w,g,n,v,s,v.user||"",y):0<=n.indexOf("#")?o.hash(c,d,w,g,n,v,s):o.any(c,d,w,g,n,v,s,v.user||"")))}l.on("opt",function(d){d.sea||(d.sea={own:{}},d.on("put",o,d)),this.to.next(d)}),o.hash=function(d,y,s,c,v,e,n){r.work(s,null,function(g){if(g&&g===c.split("#").slice(-1)[0])return d.to.next(y);n("Data hash not same as hash!")},{name:"SHA-256"})},o.alias=function(d,y,s,c,v,e,n){return s?"~@"+c===i(s)?d.to.next(y):void n("Alias not same!"):n("Data must exist!")},o.pubs=function(d,y,s,c,v,e,n){return s?c===i(s)?d.to.next(y):void n("Alias not same!"):n("Alias must exist!")},o.pub=async function(d,y,s,c,v,e,n,g,w){var S;let x=await u.parse(s)||{},T=(A,D,C)=>{if(A.m&&A.s&&D&&w)return r.verify(A,w,m=>{if(t!==m&&t!==m.e&&y.put[">"]&&y.put[">"]>parseFloat(m.e))return n("Certificate expired.");if(t!==m&&m.c&&m.w&&(m.c===D||-1<m.c.indexOf("*"))){let E=-1<v.indexOf("/")?v.replace(v.substring(0,v.indexOf("/")+1),""):"";var O;String.match=String.match||l.text.match;for(let P of Array.isArray(m.w)?m.w:typeof m.w=="object"||typeof m.w=="string"?[m.w]:[])if(String.match(E,P["#"])&&String.match(c,P["."])||!P["."]&&String.match(E,P["#"])||!P["#"]&&String.match(c,P["."])||String.match(E?E+"/"+c:c,P["#"]||P))return P["+"]&&-1<P["+"].indexOf("*")&&E&&E.indexOf(D)==-1&&c.indexOf(D)==-1?n(`Path "${E}" or key "${c}" must contain string "${D}".`):m.wb&&(typeof m.wb=="string"||(m.wb||{})["#"])?(O=d.as.root.$.back(-1),(O=typeof m.wb=="string"&&m.wb.slice(0,1)!=="~"?O.get("~"+w):O).get(m.wb).get(D).once(q=>!q||q!==1&&q!==!0?C(m):n(`Certificant ${D} blocked.`))):C(m);return n("Certificate verification fail.")}})};if(c==="pub"&&"~"+w===v)return s===w?d.to.next(y):n("Account not same!");(S=g.is)&&S.pub&&!x["*"]&&!x["+"]&&(w===S.pub||w!==S.pub&&((y._.msg||{}).opt||{}).cert)?r.opt.pack(y.put,A=>{r.sign(A,g._.sea,async function(D){if(t===D)return n(r.err||"Signature fail.");if(y.put[":"]={":":S=r.opt.unpack(D.m),"~":D.s},y.put["="]=S,w===g.is.pub)return(S=i(s))&&((e.sea.own[S]=e.sea.own[S]||{})[w]=1),void JSON.stringifyAsync(y.put[":"],function(C,m){return C?n(C||"Stringify error."):(y.put[":"]=m,d.to.next(y))});if(w!==g.is.pub&&((y._.msg||{}).opt||{}).cert){let C=await u.parse(y._.msg.opt.cert);C&&C.m&&C.s&&T(C,g.is.pub,m=>{y.put[":"]["+"]=C,y.put[":"]["*"]=g.is.pub,JSON.stringifyAsync(y.put[":"],function(O,E){return O?n(O||"Stringify error."):(y.put[":"]=E,d.to.next(y))})})}},{raw:1})}):r.opt.pack(y.put,A=>{r.verify(A,x["*"]||w,function(D){var C;return D=r.opt.unpack(D),t===D?n("Unverified data."):((C=i(D))&&w===r.opt.pub(C)&&((e.sea.own[C]=e.sea.own[C]||{})[w]=1),x["+"]&&x["+"].m&&x["+"].s&&x["*"]?void T(x["+"],x["*"],m=>(y.put["="]=D,d.to.next(y))):(y.put["="]=D,d.to.next(y)))})})},o.any=function(d,y,s,c,v,e,n,g){if(e.opt.secure)return n("Soul missing public key at '"+c+"'.");e.on("secure",function(w){if(this.off(),!e.opt.secure)return d.to.next(w);n("Data cannot be changed.")}).on.on("secure",y)};var a=l.valid,i=function(d,y){return typeof(y=a(d))=="string"&&y},f=((l.state||"").ify,/[^\w_-]/),k=(r.opt.pub=function(d){if((d=d&&(d=d.split("~"))&&d[1])&&(d=d.split(f).slice(0,2))&&d.length==2&&(d[0]||"")[0]!=="@")return d=d.slice(0,2).join(".")},r.opt.stringy=function(d){},r.opt.pack=function(d,y,s,c,v){var e,n;if(r.opt.check(d))return y(d);d&&d["#"]&&d["."]&&d[">"]&&(e=d[":"],n=1),JSON.parseAsync(n?e:d,function(g,w){var S=t!==(w||"")[":"]&&(w||"")["~"];y(S?{m:{"#":v||d["#"],".":s||d["."],":":(w||"")[":"],">":d[">"]||l.state.is(c,s)},s:S}:d)})},r.opt),h=(r.opt.unpack=function(d,y,s){if(t!==d){if(d&&t!==(c=d[":"]))return c;if(y=y||k.fall_key,!s&&k.fall_val&&((s={})[y]=k.fall_val),y&&s){if(d===s[y]||!r.opt.check(s[y]))return d;var c=s&&s._&&s._["#"]||k.fall_soul,s=l.state.is(s,y)||k.fall_state;return d&&d.length===4&&c===d[0]&&y===d[1]&&h(s)===h(d[3])?d[2]:s<r.opt.shuffle_attack?d:void 0}}},r.opt.shuffle_attack=15463296e5,Math.floor)})(b,"./index")})()});W()})();(()=>{var V=(z=>typeof Q<"u"?Q:typeof Proxy<"u"?new Proxy(z,{get:(W,G)=>(typeof Q<"u"?Q:W)[G]}):z)(function(z){if(typeof Q<"u")return Q.apply(this,arguments);throw new Error('Dynamic require of "'+z+'" is not supported')});(()=>{var z=(H=>typeof V<"u"?V:typeof Proxy<"u"?new Proxy(H,{get:(b,Y)=>(typeof V<"u"?V:b)[Y]}):H)(function(H){if(typeof V<"u")return V.apply(this,arguments);throw new Error('Dynamic require of "'+H+'" is not supported')}),W=(H,b)=>()=>(b||H((b={exports:{}}).exports,b),b.exports),G=W((H,b)=>{(function(){function Y(t,r){return r?z(t):t.slice?Y[u(t)]:function(l,o){t(l={exports:{}}),Y[u(o)]=l.exports};function u(l){return l.split("/").slice(-1).toString().replace(".js","")}}if(typeof b<"u")var $=b;Y(function(t){typeof window<"u"&&(t.window=window);var r=t.window||t,u=r.Connection||function(){};(u.window=t.window)&&(u.window.Connection=u);try{typeof $<"u"&&($.exports=u)}catch{}t.exports=u})(Y,"./root"),Y(function(t){var r=Y("./root"),u=r.window.Database;(u.Connection=r).Database=u;var l=0;Database.on("opt",function(k){o(k),this.to.next(k)});function o(k){if(!k.connection){var h=k.opt,d=h.peers;if(h.connection!==!1&&!!u.window){var y=k.connection={},s,c,v=JSON.parse((localStorage||"")[(h.file||"")+"peers/"]||null)||{};Object.keys(v.peers||"").forEach(function(n){s=d[c=n]=d[c]||{},s.id=s.url=c}),s=d[c="https://gun-rs.iris.to/gun"]=d[c]||{},s.id=s.url=c;var e=h.mesh=h.mesh||Database.Mesh(k);e.way=function(n){if(k.$===n.$||(n._||"").via){e.say(n,h.peers);return}var g=(n.$||"")._;if(!g){e.say(n,h.peers);return}if(n.get){if(g.connection)return;g.connection={}}e.say(n,h.peers)}}}}var a={},i=!0,f;t.exports=r})(Y,"./connection")})()});G()})()})();})();
