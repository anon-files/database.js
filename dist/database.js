(()=>{var Y=(A=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(A,{get:(V,b)=>(typeof require!="undefined"?require:V)[b]}):A)(function(A){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+A+'" is not supported')});var ee=(A,V)=>()=>(V||A((V={exports:{}}).exports,V),V.exports);var te=ee((ne,X)=>{(function(){function A(b,c){return c?Y(b):b.slice?A[y(b)]:function(h,$){b(h={exports:{}}),A[y($)]=h.exports};function y(h){return h.split("/").slice(-1).toString().replace(".js","")}}if(typeof X<"u")var V=X;A(function(b){String.random=function(e,t){var l="";for(e=e||24,t=t||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<e--;)l+=t.charAt(Math.floor(Math.random()*t.length));return l},String.match=function(e,t){var l,f;return typeof e=="string"&&(typeof t=="string"&&(t={"=":t}),e===(l=(t=t||{})["="]||t["*"]||t[">"]||t["<"])||f===t["="]&&(l=t["*"]||t[">"],e.slice(0,(l||"").length)===l||f===t["*"]&&(f!==t[">"]&&f!==t["<"]?e>=t[">"]&&e<=t["<"]:f!==t[">"]&&e>=t[">"]||f!==t["<"]&&e<=t["<"])))},String.hash=function(e,t){if(typeof e=="string"){if(t=t||0,!e.length)return t;for(var l=0,f=e.length;l<f;++l)t=(t<<5)-t+e.charCodeAt(l),t|=0;return t}};var c,y,h,$,s,a,d,v,_,k,S,p,i,r,m=Object.prototype.hasOwnProperty;Object.plain=function(e){return!!e&&(e instanceof Object&&e.constructor===Object||Object.prototype.toString.call(e).match(/^\[object (\w+)\]$/)[1]==="Object")},Object.empty=function(e,t){for(var l in e)if(m.call(e,l)&&(!t||t.indexOf(l)==-1))return!1;return!0},Object.keys=Object.keys||function(e){var t=[];for(var l in e)m.call(e,l)&&t.push(l);return t},c=setTimeout,h=y=0,$=typeof setImmediate!=""+void 0&&setImmediate||c,c.hold=c.hold||9,c.poll=c.poll||function(e){c.hold>=+new Date-y&&h++<3333?e():$(function(){y=+new Date,e()},h=0)},a=setTimeout,v=(d=a.turn=a.turn||function(e){v.push(e)==1&&_(S)}).s=[],_=a.poll,k=0,S=function(){(s=v[k++])&&s(),k!=v.length&&k!=99||(v=d.s=v.slice(k),k=0),v.length&&_(S)},i=setTimeout,r=i.turn,(i.each=i.each||function(e,t,l,f){f=f||9,function j(g,w,T){if(w=(g=(e||[]).splice(0,f)).length){for(var N=0;N<w&&p===(T=t(g[N]));N++);if(p===T)return void r(j)}l&&l(T)}()})()})(A,"./shim"),A(function(b){b.exports=function c(y,h,$){if(!y)return{to:c};var s=typeof h=="function";if(y=(this.tag||(this.tag={}))[y]||s&&(this.tag[y]={tag:y,to:c._={next:function(d){var v;(v=this.to)&&v.next(d)}}}),s){var a={off:c.off||(c.off=function(){if(this.next===c._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=c._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:c._,next:h,the:y,on:this,as:$};return(a.back=y.last||y).to=a,y.last=a}return(y=y.to)&&h!==void 0&&y.next(h),y}})(A,"./onto"),A(function(b){b.exports=function(c){return c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"&&c!=1/0&&c!=-1/0&&c==c||!!c&&typeof c["#"]=="string"&&Object.keys(c).length===1&&c["#"]}})(A,"./valid"),A(function(b){function c(){var s=+new Date;return $=$<s?(y=0,s+c.drift):s+(y+=1)/h+c.drift}A("./shim"),c.drift=0;var y=0,h=999,$=-1/0;c.is=function(s,a,d){var v=a&&s&&s._&&s._[">"]||d;if(v)return typeof(v=v[a])=="number"?v:-1/0},c.ify=function(s,a,d,v,_){(s=s||{})._=s._||{},_&&(s._["#"]=_);var k=s._[">"]||(s._[">"]={});return a!==void 0&&a!=="_"&&(typeof d=="number"&&(k[a]=d),v!==void 0&&(s[a]=v)),s},b.exports=c})(A,"./state"),A(function(b){A("./shim"),b.exports=function(c){var y={s:{}},h=y.s;c=c||{max:999,age:9e3},y.check=function(s){return!!h[s]&&$(s)};var $=y.track=function(s){var a=h[s]||(h[s]={});return a.was=y.now=+new Date,y.to||(y.to=setTimeout(y.drop,c.age+9)),a};return y.drop=function(s){y.to=null,y.now=+new Date;var a=Object.keys(h);console.STAT&&console.STAT(y.now,+new Date-y.now,"dup drop keys"),setTimeout.each(a,function(d){var v=h[d];v&&(s||c.age)>y.now-v.was||delete h[d]},0,99)},y}})(A,"./dup"),A(function(b){A("./onto"),b.exports=function(y,h){if(this.on){var $=(this.opt||{}).lack||9e3;if(typeof y!="function"){if(!y)return;var s=y["#"]||y,a=(this.tag||"")[s];return a?(h&&(a=this.on(s,h),clearTimeout(a.err),a.err=setTimeout(function(){a.off()},$)),!0):void 0}if(s=h&&h["#"]||c(9),!y)return s;var d=this.on(s,y,h);return d.err=d.err||setTimeout(function(){d.off(),d.next({err:"Error: No ACK yet.",lack:!0})},$),s}};var c=String.random||function(){return Math.random().toString(36).slice(2)}})(A,"./ask"),A(function(b){function c(p){return p instanceof c?(this._={$:this}).$:this instanceof c?c.create(this._={$:this,opt:p}):new c(p)}function y(p,i){var r=+new Date,m=p._||{},e=m.DBG=p.DBG,t=p["#"],l=a(9),f=Object.keys(i||"").sort(),j=((i||"")._||"")["#"],g=(f.length,p.$._.root),w=i===g.graph[j];console.STAT&&console.STAT(r,((e||m).gk=+new Date)-r,"got keys"),i&&function T(){r=+new Date;for(var N,E,u,D=0,J={};D<9&&(N=f[D++]);)k(J,N,_(i,N),i[N],j);f=f.slice(D),(E={})[j]=J,J=E,w&&((u=function(){}).ram=u.faith=!0),E=f.length,console.STAT&&console.STAT(r,-(r-(r=+new Date)),"got copied some"),e&&(e.ga=+new Date),g.on("in",{"@":t,"#":l,put:J,"%":E?l=a(9):h,$:g.$,_:u,DBG:e}),console.STAT&&console.STAT(r,+new Date-r,"got in"),E&&setTimeout.turn(T)}(),i||g.on("in",{"@":p["#"]})}c.is=function(p){return p instanceof c||p&&p._&&p===p._.$||!1},c.version=.202,(c.chain=c.prototype).toJSON=function(){},A("./shim"),c.valid=A("./valid"),c.state=A("./state"),c.on=A("./onto"),c.dup=A("./dup"),c.ask=A("./ask"),function(){function p(u){if(u)if(u.out!==p){var D,J=this.as,G=J.at||J,W=G.$,q=G.dup,I=u.DBG;if((D=u["#"])||(D=u["#"]=a(9)),!q.check(D)){if(q.track(D),D=u._,u._=typeof D=="function"?D:function(){},u.$&&u.$===(u.$._||"").$||(u.$=W),u["@"]&&!u.put&&function(P){var C,H=P["@"]||"";!(C=H._)||(C.acks=(C.acks||0)+1,(C.err=P.err)&&(P["@"]=C["#"],e(C)),C.stop||C.crack||(C.crack=C.match&&C.match.push(function(){t(C)})),t(C))}(u),!G.ask(u["@"],u)){if(I&&(I.u=+new Date),u.put)return void i(u);u.get&&c.on.get(u,W)}I&&(I.uc=+new Date),this.to.next(u),I&&(I.ua=+new Date),u.nts||u.NTS||(u.out=p,G.on("out",u),I&&(I.ue=+new Date))}}else this.to.next(u)}function i(u){if(u){var D=u._||"",J=D.root=((D.$=u.$||"")._||"").root;if(u["@"]&&D.faith&&!D.miss)return u.out=p,void J.on("out",u);D.latch=J.hatch,D.match=J.hatch=[];var G=u.put,W=D.DBG=u.DBG,q=+new Date;if(l=l||q,!G["#"]||!G["."]){W&&(W.p=q),D["#"]=u["#"],D.msg=u,D.all=0,D.stun=1;var I=Object.keys(G);console.STAT&&console.STAT(q,((W||D).pk=+new Date)-q,"put sort");var P,C,H,U,Q,O,o,n=0;(function x(B){if(P!=n){if(!(H=I[P=n]))return console.STAT&&console.STAT(q,((W||D).pd=+new Date)-q,"put"),void e(D);(U=G[H])?(o=U._)?H!==o["#"]?O=f+j(H)+"soul not same.":(Q=o[">"])||(O=f+j(H)+"no state."):O=f+j(H)+"no meta.":O=f+j(H)+"no node.",C=Object.keys(U||{})}if(O)return u.err=D.err=O,void e(D);var M,K=0;for(B=B||0;B++<9&&(M=C[K++]);)if(M!=="_"){var z=U[M],L=Q[M];if(h===L){O=f+j(M)+"on"+j(H)+"no state.";break}if(!v(z)){O=f+j(M)+"on"+j(H)+"bad "+typeof z+j(z);break}r(z,M,H,L,u),++N}(C=C.slice(K)).length?d(x):(++n,C=null,x(B))})()}}}function r(u,D,J,G,W){var q,I=W._||"",P=I.root,C=P.graph,H=C[J]||S,U=_(H,D,1),Q=H[D],O=I.DBG;(q=console.STAT)&&(C[J]&&Q||(q.has=(q.has||0)+1));var o=T();if(o<G)return setTimeout(function(){r(u,D,J,G,W)},(q=G-o)>w?w:q),void(console.STAT&&console.STAT((O||I).Hf=+new Date,q,"future"));if((!(G<U)||I.miss)&&(I.faith||G!==U||!(u===Q||g(u)<=g(Q))||I.miss)){I.stun++;var n=W["#"]+I.all++,x={toString:function(){return n},_:I};x.toJSON=x.toString,O&&(O.ph=O.ph||+new Date),P.on("put",{"#":x,"@":W["@"],put:{"#":J,".":D,":":u,">":G},_:I})}}function m(u){var D;(D=(u._||"").DBG)&&(D.pa=+new Date,D.pm=D.pm||+new Date);var J,G=this.as,W=G.graph,q=u._,I=u.put,P=I["#"],C=I["."],H=I[":"],U=I[">"];u["#"],(J=q.msg)&&(J=J.put)&&(J=J[P])&&k(J,C,U,H,P),W[P]=k(W[P],C,U,H,P),(J=(G.next||"")[P])&&J.on("in",u),e(q),this.to.next(u)}function e(u,D){var J;if(!u.stop&&(u.err||!(0<--u.stun))&&(u.stop=1,J=u.root)){var G=u.match;G.end=1,G===J.hatch&&(!(G=u.latch)||G.end?delete J.hatch:J.hatch=G),u.hatch&&u.hatch(),setTimeout.each(u.match,function(W){W&&W()}),!(D=u.msg)||u.err||D.err||(D.out=p,u.root.on("out",D),E())}}function t(u){u&&u.root&&(u.stun||u.acks!==u.all||u.root.on("in",{"@":u["#"],err:u.err,ok:u.err?h:{"":1}}))}c.create=function(u){u.root=u.root||u,u.graph=u.graph||{},u.on=u.on||c.on,u.ask=u.ask||c.ask,u.dup=u.dup||c.dup();var D=u.$.opt(u.opt);return u.once||(u.on("in",p,u),u.on("out",p,u),u.on("put",m,u),c.on("create",u),u.on("create",u)),u.once=1,D},c.on.put=i;var l,f="Error: Invalid graph!",j=function(u){return" '"+(""+u).slice(0,9)+"...' "},g=JSON.stringify,w=2147483647,T=c.state,N=0,E=function(){999<N&&1<N/-(l-(l=+new Date))&&(c.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),E=function(){N=0})}}(),c.on.get=function(p,i){var r=i._,m=p.get,e=m["#"],t=r.graph[e],l=m["."],f=((r.next||(r.next={}))[e],(p._||{}).DBG=p.DBG);if(f&&(f.g=+new Date),!t)return r.on("get",p);if(l){if(typeof l!="string"||h===t[l])return r.on("get",p);t=k({},l,_(t,l),t[l],e)}t&&y(p,t),r.on("get",p)},c.on.get.ack=y,c.chain.opt=function(p){p=p||{};var i=this._,r=p.peers||p;return Object.plain(p)||(p={}),Object.plain(i.opt)||(i.opt=p),typeof r=="string"&&(r=[r]),Object.plain(i.opt.peers)||(i.opt.peers={}),r instanceof Array&&(p.peers={},r.forEach(function(m){var e={};e.id=e.url=m,p.peers[m]=i.opt.peers[m]=i.opt.peers[m]||e})),s(p,function m(e){var t=this[e];this&&this.hasOwnProperty(e)||typeof t=="string"||Object.empty(t)?this[e]=t:(!t||t.constructor===Object||t instanceof Array)&&s(t,m)}),i.opt.from=p,c.on("opt",i),i.opt.uuid=i.opt.uuid||function(m){return c.state().toString(36).replace(".","")+String.random(m||12)},this};var h,$,s=function(p,i){Object.keys(p).forEach(i,p)},a=String.random,d=setTimeout.turn,v=c.valid,_=c.state.is,k=c.state.ify,S={};(c.log=function(){return c.log.off||$.log.apply($,arguments),[].slice.call(arguments).join(" ")}).once=function(p,i,r){return(r=c.log.once)[p]=r[p]||0,r[p]++||c.log(i)},typeof window<"u"&&((window.Database=c).window=window);try{V!==void 0&&(V.exports=c)}catch{}((b.exports=c).window||{}).console=(c.window||{}).console||{log:function(){}},($=console).only=function(p,i){return $.only.i&&p===$.only.i&&$.only.i++&&($.log.apply($,arguments)||i)}})(A,"./root"),A(function(b){A("./root").chain.back=function(y,h){if((y=y||1)===-1||1/0===y)return this._.root.$;if(y===1)return(this._.back||this._).$;var $=this._;if(typeof y=="string"&&(y=y.split(".")),y instanceof Array){for(var s=0,a=y.length,d=$;s<a;s++)d=(d||c)[y[s]];return d!==void 0?h?this:d:(d=$.back)?d.$.back(y,h):void 0}if(typeof y!="function")return typeof y=="number"?($.back||$).$.back(y-1):this;var v;for(d={back:$};(d=d.back)&&(v=y(d,h))===void 0;);return v};var c={}})(A,"./back"),A(function(b){var c=A("./root");function y(i,r){if(r=r||this.as||i.$._,(!i.$$||this===c.on)&&i.put&&!r.soul){var m=i.put||"",e=m["="]||m[":"],t=r.root,l=t.$.get(m["#"]).get(m["."])._;if(typeof(e=v(e))=="string"){if(!(l.echo||(l.echo={}))[r.id]||(t.pass||"")[r.id]){if(f=t.pass){if(f[e+r.id])return;f[e+r.id]=1}((l.echo||(l.echo={}))[r.id]=r).has&&(r.link=e);var f,j=t.$.get(l.link=e)._;(j.echo||(j.echo={}))[l.id]=l,((f=r.ask||"")[""]||r.lex)&&j.on("out",{get:{"#":e}}),setTimeout.each(Object.keys(f),function(g,w){g&&(w=f[g])&&w.on("out",{get:{"#":e,".":g}})},0,99)}}else this===c.on&&((l.echo||(l.echo={}))[r.id]=r)}}function h(i,r){var m,e,t=i.put||"",l=s!==t["="]?t["="]:t[":"],f=r.root;if(s===l)return r.soul&&s!==r.put||(e=(i.$$||i.$||"")._||"",i["@"]&&(s!==e.put||s!==r.put))?void 0:((m=r.link||i.linked)&&delete(f.$.get(m)._.echo||"")[r.id],r.has&&(r.link=null),r.put=s,void setTimeout.each(Object.keys(r.next||""),function(j,g){(g=r.next[j])&&(m&&delete(f.$.get(m).get(j)._.echo||"")[g.id],g.on("in",{get:j,put:s,$:g.$}))},0,99));r.soul||i.$$||(m=v(l),e=i.$._||"",(m!==e.link&&(!r.has||e.link)||(f.pass||"")[r.id]&&typeof m!="string")&&(delete(e.echo||"")[r.id],h({get:r.get,put:s,$:i.$,linked:i.linked=i.linked||e.link},r)))}function $(i,r){var m=this.as,e=m.$._,t=(e.root,m.get||""),l=(i.put||"")[t["#"]]||"";if(!i.put||typeof t["."]=="string"&&s===l[t["."]])return s!==e.put||!e.soul&&!e.has?void 0:(e.ack=(e.ack||0)+1,void e.on("in",{get:e.get,put:e.put=s,$:e.$,"@":i["@"]}));(i._||{}).miss=1,c.on.put(i)}c.chain.chain=function(i){var r,m=this._,e=new(i||this).constructor(this),t=e._;return t.root=r=m.root,t.id=++r.once,t.back=this._,t.on=c.on,t.on("in",c.on.in,t),t.on("out",c.on.out,t),e},c.on.out=function(i){var r,m,e=this.as,t=e.back,l=e.root;if(i.$||(i.$=e.$),this.to.next(i),!e.err){if(r=i.get){if(l.pass&&(l.pass[e.id]=e),e.lex&&Object.keys(e.lex).forEach(function(f){m[f]=e.lex[f]},m=i.get=i.get||{}),r["#"]||e.soul){if(r["#"]=r["#"]||e.soul,i["#"]||(i["#"]=d(9)),t=l.$.get(r["#"])._,r=r["."]){if(_(t.put,r)&&(m=t.ask&&t.ask[r],(t.ask||(t.ask={}))[r]=t.$.get(r)._,t.on("in",{get:r,put:{"#":t.soul,".":r,":":t.put[r],">":S(l.graph[t.soul],r)}}),m))return}else{if(m=t.ask&&t.ask[""],(t.ask||(t.ask={}))[""]=t,s!==t.put&&(t.on("in",t),m))return;i.$=t.$}return l.ask($,i),l.on("in",i)}if(r["."])return e.get?(i={get:{".":e.get},$:e.$},(t.ask||(t.ask={}))[e.get]=i.$._):i={get:e.lex?i.get:{},$:e.$},t.on("out",i);if(((e.ask||(e.ask={}))[""]=e).get)return r["."]=e.get,(t.ask||(t.ask={}))[e.get]=i.$._,t.on("out",i)}return t.on("out",i)}e.on("in",{put:e.put=s,$:e.$})},c.on.in=function(i,r){var m,e=(r=r||this.as).root,t=i.$||(i.$=r.$),l=(t||"")._||a,f=i.put||"",j=f["#"],g=f["."],w=s!==f["="]?f["="]:f[":"],T=f[">"]||-1/0;if(s!==i.put&&(s===f["#"]||s===f["."]||s===f[":"]&&s===f["="]||s===f[">"]))return v(f)?void r.on("in",{$:l.back.$,put:{"#":j=l.back.soul,".":g=l.has||l.get,"=":f,">":S(l.back.put,g)},via:i}):(j=((f||"")._||"")["#"])?(t=r.root.$.get(j),setTimeout.each(Object.keys(f).sort(),function(N){N!="_"&&s!==(T=S(f,N))&&r.on("in",{$:t,put:{"#":j,".":N,"=":f[N],">":T},VIA:i})})):void console.log("chain not yet supported for",f,"...",i,r);(i.seen||"")[r.id]||(((i.seen||(i.seen=function(){}))[r.id]=r)!==l&&(Object.keys(i).forEach(function(N){f[N]=i[N]},f={}),f.get=r.get||f.get,r.soul||r.has?l.soul&&(f.$=r.$,f.$$=f.$$||l.$):f.$$$=f.$$$||r.$,i=f),h(i,r),(r.soul||i.$$)&&T>=S(e.graph[j],g)&&((f=e.$.get(j)._).put=p(f.put,g,T,w,j)),!l.soul&&T>=S(e.graph[j],g)&&(m=(e.$.get(j)._.next||"")[g])&&(m.put=w,typeof(f=v(w))=="string"&&(m.put=e.$.get(f)._.put||w)),this.to&&this.to.next(i),r.any&&setTimeout.each(Object.keys(r.any),function(N){(N=r.any[N])&&N(i)},0,99),r.echo&&setTimeout.each(Object.keys(r.echo),function(N){(N=r.echo[N])&&N.on("in",i)},0,99),((i.$$||"")._||l).soul&&(m=r.next)&&(m=m[g])&&(f={},Object.keys(i).forEach(function(N){f[N]=i[N]}),f.$=(i.$$||i.$).get(f.get=g),delete f.$$,delete f.$$$,m.on("in",f)),y(i,r))},c.on.link=y,c.on.unlink=h;var s,a={},d=String.random,v=c.valid,_=function(i,r){return i&&Object.prototype.hasOwnProperty.call(i,r)},k=c.state,S=k.is,p=k.ify})(A,"./chain"),A(function(b){var c=A("./root");function y(a){var d=this.at||this.on;if(!a||d.soul||d.has)return this.off();if(a=(a=(a=a.$||a)._||a).id){var v;if(d.map,(v=this.seen||(this.seen={}))[a])return!0;v[a]=!0}}c.chain.get=function(a,d,v){var _,k;if(typeof a=="string"){if(a.length==0)return(_=this.chain())._.err={err:c.log("0 length key!",a)},d&&d.call(_,_._.err),_;(_=((p=this._).next||$)[a])||(_=a&&function(t,l){var f=l._,j=f.next,g=l.chain()._;return j=j||(f.next={}),j[g.get=t]=g,l===f.root.$?g.soul=t:(f.soul||f.has)&&(g.has=t),g}(a,this)),_=_&&_.$}else{if(typeof a=="function"){let t=function(l,f,j){if(!t.stun&&(!(g=r.pass)||g[S])){var g,w=l.$._,T=(l.$$||"")._,N=(T||w).put,E=!w.has&&!w.soul,u={};if(!E&&h!==N||(N=h===((g=l.put)||"")["="]?h===(g||"")[":"]?g:g[":"]:g["="]),typeof(g=c.valid(N))=="string"&&(N=h===(g=r.$.get(g)._.put)?i.not?h:N:g),!i.not||h!==N){if(h===i.stun){if((g=r.stun)&&g.on&&(p.$.back(function(D){if(g.on(""+D.id,u={}),(u.run||0)<t.id)return u}),u.run||g.on(""+w.id,u={}),!u.run&&T&&g.on(""+T.id,u={}),t.id>u.run&&(u.stun&&!u.stun.end||(u.stun=g.on("stun"),u.stun=u.stun&&u.stun.last),u.stun&&!u.stun.end)))return void((u.stun.add||(u.stun.add={}))[S]=function(){t(l,f,1)});if(h===N&&(j=0),(g=r.hatch)&&!g.end&&h===i.hatch&&!j)return m[w.$._.id]?void 0:(m[w.$._.id]=1,void g.push(function(){t(l,f,1)}));m={}}if(r.pass){if(r.pass[S+w.id])return;r.pass[S+w.id]=1}i.on?i.ok.call(w.$,N,w.get,l,f||t):i.v2020?i.ok(l,f||t):(Object.keys(l).forEach(function(D){g[D]=l[D]},g={}),(l=g).put=N,i.ok.call(i.as,l,f||t))}}};var e=t;if(d===!0)return function(l,f,j,g){var w,T=l._,N=0;if(w=T.soul||T.link)return f(w,g,T);if(T.jam)return T.jam.push([f,g]);T.jam=[[f,g]],l.get(function(E,u){if(!(h===E.put&&!T.root.opt.super&&(w=Object.keys(T.root.opt.peers).length)&&++N<=w)){u.rid(E);var D,J=(J=E.$)&&J._||{},G=0;for(w=T.jam,delete T.jam;D=w[G++];){var W=D[0];D=D[1],W&&W(J.link||J.soul||c.valid(E.put)||((E.put||{})._||{})["#"],D,E,u)}}},{out:{get:{".":!0}}})}(this,a,0,v),this;var S,p=(_=this)._,i=d||{},r=p.root;i.at=p,i.ok=a;var m={};return(((t.at=p).any||(p.any={}))[S=String.random(7)]=t).off=function(){t.stun=1,p.any&&delete p.any[S]},t.rid=y,t.id=i.run||++r.once,k=r.pass,(r.pass={})[S]=1,i.out=i.out||{get:{}},p.on("out",i.out),r.pass=k,_}if(typeof a=="number")return this.get(""+a,d,v);if(typeof(k=s(a))=="string")return this.get(k,d,v);(k=this.get.next)&&(_=k(this,a))}return _?d&&typeof d=="function"&&_.get(d,v):((_=this.chain())._.err={err:c.log("Invalid get request!",a)},d&&d.call(_,_._.err)),_};var h,$={},s=c.valid})(A,"./get"),A(function(b){var c=A("./root");function y(v,_){if(_){_=(_._||"").id||_;var k,S=v.root.stun||(v.root.stun={on:c.on}),p={};v.stun||(v.stun=S.on("stun",function(){})),(k=S.on(""+_))&&k.the.last.next(p),p.run>=v.run||S.on(""+_,function(i){if(v.stun.end)return this.off(),void this.to.next(i);i.run=i.run||v.run,i.stun=i.stun||v.stun})}}function h(v){if(v.err)h.end(v.stun,v.root);else if(!v.todo.length&&!v.end&&Object.empty(v.wait)){v.end=1;var _,k=v.$.back(-1)._,S=k.root,p=k.ask(function(m){S.on("ack",m),m.err&&c.log(m),++i>(v.acks||0)&&this.off(),v.ack&&v.ack(m,this)},v.opt),i=0,r=v.stun;(_=function(){r&&(h.end(r,S),setTimeout.each(Object.keys(r=r.add||""),function(m){(m=r[m])&&m()}))}).hatch=_,v.via._.on("out",{put:v.out=v.graph,opt:v.opt,"#":p,_})}}c.chain.put=function(v,_,k){var S=this,p=S._,i=p.root;(k=k||{}).root=p.root,k.run||(k.run=i.once),y(k,p.id),k.ack=k.ack||_,k.via=k.via||S,k.data=k.data||v,k.soul||(k.soul=p.soul||typeof _=="string"&&_);var r=k.state=k.state||c.state();return typeof v=="function"?v(function(m){k.data=m,S.put(void 0,void 0,k)}):k.soul?(k.$=i.$.get(k.soul),k.todo=[{it:k.data,ref:k.$}],k.turn=k.turn||s,k.ran=k.ran||h,function m(){var e,t,l,f,j,g=k.todo,w=g.pop(),T=w.it;if(w.ref&&w.ref._.id,y(k,w.ref),(f=w.todo)&&(T=T[t=f.pop()],f.length&&g.push(w)),t&&(g.path||(g.path=[])).push(t),!(e=a(T))&&!(j=c.is(T))){if(!Object.plain(T))return void h.err(k,"Invalid data: "+function(J,G){return J&&(G=J.constructor)&&G.name||typeof J}(T)+" at "+(k.via.back(function(J){J.get&&f.push(J.get)},f=[])||f.join("."))+"."+(g.path||[]).join("."));for(var N=k.seen||(k.seen=[]),E=N.length;E--;)if(T===(f=N[E]).it){e=T=f.link;break}}if(t&&e)w.node=d(w.node,t,r,T);else{let J=function(G,W){var q=l.link["#"];W&&(W.off(),W.rid(G));var I=q||G.soul||(f=(G.$$||G.$)._||"").soul||f.link||((f=f.put||"")._||"")["#"]||f["#"]||((f=G.put||"")&&G.$$?f["#"]:(f["="]||f[":"]||"")["#"]);q||y(k,G.$),I||w.link["#"]?(I||(I=[],(G.$$||G.$).back(function(P){if(f=P.soul||P.link)return I.push(f);I.push(P.get)}),I=I.reverse().join("/")),l.link["#"]=I,j||(((k.graph||(k.graph={}))[I]=l.node||(l.node={_:{}}))._["#"]=I),delete k.wait[u],l.wait&&setTimeout.each(l.wait,function(P){P&&P()}),k.ran(k)):(w.wait||(w.wait=[])).push(function(){J(G,W)})};var D=J;if(!k.seen)return void h.err(k,"Data at root of graph must be a node (an object).");k.seen.push(l={it:T,link:{},todo:j?[]:Object.keys(T).sort().reverse(),path:(g.path||[]).slice(),up:w}),w.node=d(w.node,t,r,l.link),!j&&l.todo.length&&g.push(l);var u=k.seen.length;(k.wait||(k.wait={}))[u]="",f=(l.ref=j?T:t?w.ref.get(t):w.ref)._,(f=T&&(T._||"")["#"]||f.soul||f.link)?J({soul:f}):l.ref.get(J,{run:k.run,v2020:1,out:{get:{".":" "}}})}if(!g.length)return k.ran(k);k.turn(m)}()):function(m){var e,t=m.via._;m.via=m.via.back(function(l){if(l.soul||!l.get)return l.$;e=m.data,(m.data={})[l.get]=e}),m.via&&m.via._.soul||(m.via=t.root.$.get(((m.data||"")._||"")["#"]||t.$.back("opt.uuid")())),m.via.put(m.data,m.ack,m)}(k),S},h.end=function(v,_){v.end=$,v.the.to===v&&v===v.the.last&&delete _.stun,v.off()},h.err=function(v,_){(v.ack||$).call(v,v.out={err:v.err=c.log(_)}),v.ran(v)};var $=function(){},s=setTimeout.turn,a=c.valid,d=c.state.ify})(A,"./put"),A(function(b){var c=A("./root");A("./chain"),A("./back"),A("./put"),A("./get"),b.exports=c})(A,"./index"),A(function(b){var c=A("./index");c.chain.on=function(y,h,$,s){var a,d=this._;if(d.root,typeof y=="string")return h?(a=d.on(y,h,$||d,s),$&&$.$&&($.subs||($.subs=[])).push(a),this):d.on(y);var v=h;return(v=v===!0?{change:!0}:v||{}).not=1,v.on=1,this.get(y,v),this},c.chain.once=function(y,h){if(h=h||{},!y)return function(v,_,k){return(k=v.chain())._.nix=v.once(function(S,p){k._.on("in",this._)}),k._.lex=v._.lex,k}(this);var $,s=this._,a=s.root,d=(s.put,String.random(7));return this.get(function(v,_,k,S){var p=this,i=p._,r=i.one||(i.one={});function m(e){i.has||i.soul||(i={put:v,get:_}),($=i.put)===void 0&&($=((k.$$||"")._||"").put),typeof c.valid($)!="string"||($=a.$.get($)._.put)!==void 0||e?S.stun||r[d]!==""&&(r[d]="",(s.soul||s.has)&&S.off(),y.call(p,$,i.get),clearTimeout(r[d])):r[d]=setTimeout(function(){m(1)},h.wait||99)}S.stun||r[d]!==""&&(($=c.valid(v))!==!0?typeof $!="string"&&(clearTimeout((s.one||"")[d]),clearTimeout(r[d]),r[d]=setTimeout(m,h.wait||99)):m())},{on:1}),this},c.chain.off=function(){var y,h=this._,$=h.back;if($)return h.ack=0,(y=$.next)&&y[h.get]&&delete y[h.get],(y=$.ask)&&delete y[h.get],(y=$.put)&&delete y[h.get],(y=h.soul)&&delete $.root.graph[y],(y=h.map)&&Object.keys(y).forEach(function(s,a){(a=y[s]).link&&$.root.$.get(a.link).off()}),(y=h.next)&&Object.keys(y).forEach(function(s,a){y[s].$.off()}),h.on("off",{}),this}})(A,"./on"),A(function(b){var c=A("./index"),y=c.chain.get.next;function h(s){this.to.next(s);var a,d=this.as,v=s.$._,_=s.put;(v.soul||s.$$)&&((a=d.lex)&&!String.match(s.get||(_||"")["."],a["."]||a["#"]||a)||c.on.link(s,d))}c.chain.get.next=function(s,a){var d;return Object.plain(a)?(d=((d=a["#"])||"")["="]||d)?s.get(d):((d=s.chain()._).lex=a,s.on("in",function(v){String.match(v.get||(v.put||"")["."],a["."]||a["#"]||a)&&d.on("in",v),this.to.next(v)}),d.$):(y||$)(s,a)},c.chain.map=function(s,a,d){var v,_,k=this,S=k._;return Object.plain(s)&&(v=s["."]?s:{".":s},s=void 0),s?(_=k.chain(),k.map().on(function(p,i,r,m){var e=(s||$).call(this,p,i,r,m);if(e!==void 0){if(p===e)return _._.on("in",r);if(c.is(e))return _._.on("in",e._);var t={};Object.keys(r.put).forEach(function(l){t[l]=r.put[l]},t),t["="]=e,_._.on("in",{get:i,put:t})}})):(_=S.each)||((S.each=_=k.chain())._.lex=v||_._.lex||S.lex,_._.nix=k.back("nix"),k.on("in",h,_._)),_};var $=function(){}})(A,"./map"),A(function(b){var c=A("./index");c.chain.set=function(y,h,$){var s,a,d=this,v=d.back(-1);return h=h||function(){},($=$||{}).item=$.item||y,(s=((y||"")._||"")["#"])&&((y={})["#"]=s),typeof(a=c.valid(y))=="string"?d.get(s=a).put(y,h,$):c.is(y)?(d.put(function(_){y.get(function(k,S,p){if(!k)return h.call(d,{err:c.log('Only a node can be linked! Not "'+p.put+'"!')});(a={})[k]={"#":k},_(a)},!0)}),y):(Object.plain(y)&&(y=v.get(s=d.back("opt.uuid")()).put(y)),d.get(s||v.back("opt.uuid")(7)).put(y,h,$))}})(A,"./set"),A(function(b){A("./shim");function c(){}var y=JSON.parseAsync||function(s,a,d){var v=+new Date;try{a(void 0,JSON.parse(s,d),h.sucks(+new Date-v))}catch(_){a(_)}},h=JSON.stringifyAsync||function(s,a,d,v){var _=+new Date;try{a(void 0,JSON.stringify(s,d,v),h.sucks(+new Date-_))}catch(k){a(k)}};h.sucks=function(s){99<s&&(h.sucks=c)};var $;try{b.exports=function(s){var a=function(){},d=s.opt||{};d.log=d.log||console.log,d.gap=d.gap||d.wait||0,d.max=d.max||.3*(d.memory?999*d.memory*999:3e8),d.pack=d.pack||.01*d.max*.01,d.puff=d.puff||9;var v=setTimeout.turn||setTimeout,_=s.dup,k=_.check,S=_.track,p=(new Date,a.hear=function(e,t){if(e){if(d.max<=e.length)return a.say({dam:"!",err:"Message too big!"},t);a===this&&(p.d+=e.length||0,++p.c);var l,f=t.SH=+new Date,j=e[0];return j==="["?(y(e,function(g,w){if(g||!w)return a.say({dam:"!",err:"DAM JSON parse error."},t);console.STAT&&console.STAT(+new Date,w.length,"# on hear batch");var T=d.puff;(function N(){for(var E,u=+new Date,D=0;D<T&&(E=w[D++]);)a.hear(E,t);w=w.slice(D),console.STAT&&console.STAT(u,+new Date-u,"hear loop"),i(t),w.length&&v(N,0)})()}),void(e="")):j==="{"||(e["#"]||Object.plain(e))&&(l=e)?l?p.one(l,t,f):void y(e,function(g,w){if(g||!w)return a.say({dam:"!",err:"DAM JSON parse error."},t);p.one(w,t,f)}):void 0}});function i(e){var t=e.batch,l=typeof t=="string";if(l&&(t+="]"),e.batch=e.tail=null,t&&(l?!(t.length<3):t.length)){if(!l)try{t=t.length===1?t[0]:JSON.stringify(t)}catch(f){return d.log("DAM JSON stringify error",f)}t&&r(t,e)}}function r(e,t){try{var l=t.wire;t.say?t.say(e):l.send&&l.send(e),a.say.d+=e.length||0,++a.say.c}catch{(t.queue=t.queue||[]).push(e)}}p.one=function(e,t,l){var f,j,g,w,T;if(e.DBG&&(e.DBG=T={DBG:e.DBG}),T&&(T.h=l),T&&(T.hp=+new Date),(f=e["#"])||(f=e["#"]=String.random(9)),!((g=k(f))||(j=e["##"])&&(g=e["@"]||e.get&&f)&&_.check(w=g+j))){if((e._=function(){}).via=a.leap=t,(g=e["><"])&&typeof g=="string"&&g.slice(0,99).split(",").forEach(function(N){this[N]=1},e._.yo={}),g=e.dam)return(g=a.hear[g])&&g(e,t,s),void S(f);l=+new Date,T&&(T.is=l),t.SI=f,s.on("in",a.last=e),T&&(T.hd=+new Date),console.STAT&&console.STAT(l,+new Date-l,e.get?"msg get":e.put?"msg put":"msg"),(g=S(f)).via=t,e.get&&(g.it=e),w&&S(w),a.leap=a.last=null}},p.c=p.d=0,function(){var e,t=0;function l(j,g){var w;return g instanceof Object?(Object.keys(g).sort().forEach(f,{to:w={},on:g}),w):g}function f(j){this.to[j]=this.on[j]}a.hash=function(j,g){var w,T,N,E=+new Date;h(j.put,function u(D,J){var G=(T=T||(N=J||"")).slice(0,32768);w=String.hash(G,w),(T=T.slice(32768))?v(u,0):(console.STAT&&console.STAT(E,+new Date-E,"say json+hash"),j._.$put=N,j["##"]=w,a.say(j,g),delete j._.$put)},l)},a.say=function(j,g){var w;if((w=this)&&(w=w.to)&&w.next&&w.next(j),!j)return!1;var T,N,E=j["@"],u=j._||(j._=function(){}),D=j.DBG,J=+new Date;if(u.y=u.y||J,g||D&&(D.y=J),(T=j["#"])||(T=j["#"]=String.random(9)),e||S(T),j.put&&(j.err||(_.s[T]||"").err))return!1;if(j["##"]||$===j.put||u.via||!E){if(!g&&E&&(g=(w=_.s[E])&&(w.via||(w=w.it)&&(w=w._)&&w.via)||(w=a.last)&&E===w["#"]&&a.leap),!g&&E)return _.s[E]?void 0:(console.STAT&&console.STAT(+new Date,++t,"total no peer to ack to"),!1);if(!g&&a.way)return a.way(j);if(D&&(D.yh=+new Date),N=u.raw){if(D&&(D.yr=+new Date),!g||!g.id){if(!Object.plain(g||d.peers))return!1;J=+new Date,d.puff;var G=d.peers,W=Object.keys(g||d.peers||{});return console.STAT&&console.STAT(J,+new Date-J,"peer keys"),void function I(){var P=+new Date;e=1;var C=u.raw;u.raw=N;for(var H,U=0;U<9&&(H=(W||"")[U++]);)(H=G[H])&&a.say(j,H);u.raw=C,e=0,W=W.slice(U),console.STAT&&console.STAT(P,+new Date-P,"say loop"),W.length&&(v(I,0),E&&S(E))}()}if(!g.wire&&a.wire&&a.wire(g),T!==g.last){if(g.last=T,g===u.via||(w=u.yo)&&(w[g.url]||w[g.pid]||w[g.id]))return!1;if(console.STAT&&console.STAT(J,((D||u).yp=+new Date)-(u.y||J),"say prep"),!e&&E&&S(E),g.batch){if(g.tail=(w=g.tail||0)+N.length,g.tail<=d.pack)return void(g.batch+=(w?",":"")+N);i(g)}g.batch="[";var q=+new Date;setTimeout(function(){console.STAT&&console.STAT(q,+new Date-q,"0ms TO"),i(g)},d.gap),r(N,g),console.STAT&&E===g.SI&&console.STAT(J,+new Date-g.SH,"say ack")}}else a.raw(j,g)}else a.hash(j,g)},a.say.c=a.say.d=0,a.raw=function(j,g){if(!j)return"";var w,T,N=j._||{};if(T=N.raw)return T;if(typeof j=="string")return j;var E=j["##"],u=j["@"];if(E&&u){if(!N.via&&k(u+E))return!1;if((T=(_.s[u]||"").it)||(T=a.last)&&u===T["#"]){if(E===T["##"])return!1;T["##"]||(T["##"]=E)}}if(!j.dam){var D=0,J=[];for(var G in T=d.peers){var W=T[G];if(J.push(W.url||W.pid||W.id),6<++D)break}1<D&&(j["><"]=J.join())}if(w=N.$put)return T={},Object.keys(j).forEach(function(I){T[I]=j[I]}),T.put=":])([:",void h(T,function(I,P){if(!I){var C=+new Date;T=P.indexOf('"put":":])([:"'),q($,P=P.slice(0,T+6)+w+P.slice(T+14)),console.STAT&&console.STAT(C,+new Date-C,"say slice")}});function q(I,P){I||(N.raw=P,a.say(j,g))}h(j,q)}}(),a.hi=function(e){var t,l=e.wire;l?(e.id?d.peers[e.url||e.id]=e:(t=e.id=e.id||String.random(9),a.say({dam:"?",pid:s.opt.pid},d.peers[t]=e),delete _.s[e.last]),e.met=e.met||+new Date,l.hied||s.on(l.hied="hi",e),t=e.queue,e.queue=[],setTimeout.each(t||[],function(f){r(f,e)},0,9)):a.wire(e.length&&{url:e}||e)},a.bye=function(e){s.on("bye",e);var t=+new Date;t-=e.met||t,a.bye.time=((a.bye.time||t)+t)/2},a.hear["!"]=function(e,t){d.log("Error:",e.err)},a.hear["?"]=function(e,t){e.pid&&(t.pid||(t.pid=e.pid),e["@"])||(a.say({dam:"?",pid:d.pid,"@":e["#"]},t),delete _.s[t.last])},s.on("create",function(e){e.opt.pid=e.opt.pid||String.random(9),this.to.next(e),e.on("out",a.say)}),s.on("bye",function(e,t){e=d.peers[e.id||e]||e,this.to.next(e),e.bye?e.bye():(t=e.wire)&&t.close&&t.close(),delete d.peers[e.id],e.wire=null});var m={};return s.on("bye",function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=(t.peers||0)-1),(t=e.url)&&(m[t]=!0,setTimeout(function(){delete m[t]},d.lack||9e3))}),s.on("hi",function(e,t){this.to.next(e),(t=console.STAT)&&(t.peers=(t.peers||0)+1),(t=e.url)&&m[t]&&(delete m[t],d.super||setTimeout.each(Object.keys(s.next),function(l){s.next[l],(t={})[l]=s.graph[l],t=String.hash(t),a.say({"##":t,get:{"#":l}},e)}))}),a}}catch{}})(A,"./mesh"),A(function(b){var c=A("../index");c.Mesh=A("./mesh"),c.on("opt",function(y){if(this.to.next(y),!y.once){var h=y.opt;if(h.WebSocket!==!1){var $=c.window||{},s=h.WebSocket||$.WebSocket||$.webkitWebSocket||$.mozWebSocket;if(s){h.WebSocket=s;var a=h.mesh=h.mesh||c.Mesh(y);a.wire||h.wire,a.wire=h.wire=_,setTimeout(function(){h.super||y.on("out",{dam:"hi"})},1);var d=1998,v=""+void 0!=typeof document&&document}}}function _(S){try{if(!S||!S.url)return i&&i(S);var p=S.url.replace(/^http/,"ws"),i=S.wire=new h.WebSocket(p);return i.onclose=function(){h.mesh.bye(S),k(S)},i.onerror=function(r){k(S)},i.onopen=function(){h.mesh.hi(S)},i.onmessage=function(r){r&&h.mesh.hear(r.data||r,S)},i}catch{}}function k(S){clearTimeout(S.defer),h.peers[S.url]&&(v&&S.retry<=0||(S.retry=(S.retry||h.retry+1||60)-(-S.tried+(S.tried=+new Date)<4*d?1:0),S.defer=setTimeout(function p(){if(v&&v.hidden)return setTimeout(p,d);_(S)},d)))}})})(A,"./websocket"),A(function(b){if(typeof Database<"u"){var c;try{c=(Database.window||function(){}).localStorage}catch{}c||(c={setItem:function(h,$){this[h]=$},removeItem:function(h){delete this[h]},getItem:function(h){return this[h]}}),JSON.parseAsync;var y=JSON.stringifyAsync||function(h,$,s,a){try{$(void 0,JSON.stringify(h,s,a))}catch(d){$(d)}};Database.on("create",function h($){this.to.next($);var s,a,d,v,_=$.opt,k=($.graph,[]);if(_.localStorage!==!1){_.prefix=_.file||"db/";try{s=h[_.prefix]=h[_.prefix]||JSON.parse(d=c.getItem(_.prefix))||{}}catch{s=h[_.prefix]={}}d=(d||"").length,$.on("get",function(p){this.to.next(p);var i,r,m,e=p.get;e&&(i=e["#"])&&((r=s[i]||void 0)&&(m=e["."])&&!Object.plain(m)&&(r=Database.state.ify({},m,Database.state.is(r,m),r[m],i)),Database.on.get.ack(p,r))}),$.on("put",function(p){this.to.next(p);var i=p.put,r=i["#"],m=i["."],e=p["#"];s[r]=Database.state.ify(s[r],m,i[">"],i[":"],r),v&&4999880<d?$.on("in",{"@":e,err:"localStorage max!"}):(p["@"]||k.push(e),a=a||setTimeout(S,9+d/333))})}function S(){if(k.length||!((setTimeout.turn||"").s||"").length){var p=k;clearTimeout(a),a=!1,k=[],y(s,function(i,r){try{i||c.setItem(_.prefix,r)}catch(m){i=v=m||"localStorage failure"}i&&$.on("localStorage:error",{err:i,get:_.prefix,put:s}),d=r.length,(i||Object.empty(_.peers))&&setTimeout.each(p,function(m){$.on("in",{"@":m,err:i,ok:0})},0,99)})}else setTimeout(S,99)}})}})(A,"./localStorage")})(),function(){if(""+l!=typeof Database){let O=function(o){};var Q=O,A,V,b=Database;b.fn=b.fn||{is:function(o){return!!o&&typeof o=="function"}},b.bi=b.bi||{is:function(o){return o instanceof Boolean||typeof o=="boolean"}},b.num=b.num||{is:function(o){return!y(o)&&(0<=o-parseFloat(o)+1||1/0===o||-1/0===o)}},b.text=b.text||{is:function(o){return typeof o=="string"}},b.text.ify=b.text.ify||function(o){return b.text.is(o)?o:typeof JSON<"u"?JSON.stringify(o):o&&o.toString?o.toString():o},b.text.random=b.text.random||function(o,n){var x="";for(o=o||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<o;)x+=n.charAt(Math.floor(Math.random()*n.length)),o--;return x},b.text.match=b.text.match||function(o,n){var x,B;return typeof o=="string"&&(typeof n=="string"&&(n={"=":n}),o===(x=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||B===n["="]&&(x=n["*"]||n[">"]||n["<"],o.slice(0,(x||"").length)===x||B===n["*"]&&(B!==n[">"]&&B!==n["<"]?o>=n[">"]&&o<=n["<"]:B!==n[">"]&&o>=n[">"]||B!==n["<"]&&o<=n["<"])))},b.text.hash=b.text.hash||function(o,n){if(typeof o=="string"){if(n=n||0,!o.length)return n;for(var x=0,B=o.length;x<B;++x)n=(n<<5)-n+o.charCodeAt(x),n|=0;return n}},b.list=b.list||{is:function(o){return o instanceof Array}},b.list.slit=b.list.slit||Array.prototype.slice,b.list.sort=b.list.sort||function(o){return function(n,x){return n&&x?(n=n[o])<(x=x[o])?-1:x<n?1:0:0}},b.list.map=b.list.map||function(o,n,x){return s(o,n,x)},b.list.index=1,b.obj=b.boj||{is:function(o){return!!o&&(o instanceof Object&&o.constructor===Object||Object.prototype.toString.call(o).match(/^\[object (\w+)\]$/)[1]==="Object")}},b.obj.put=b.obj.put||function(o,n,x){return(o||{})[n]=x,o},b.obj.has=b.obj.has||function(o,n){return o&&Object.prototype.hasOwnProperty.call(o,n)},b.obj.del=b.obj.del||function(o,n){if(o)return o[n]=null,delete o[n],o},b.obj.as=b.obj.as||function(o,n,x,B){return o[n]=o[n]||(B===x?{}:x)},b.obj.ify=b.obj.ify||function(o){if(h(o))return o;try{o=JSON.parse(o)}catch{o={}}return o},b.obj.to=b.obj.to||function(o,n){return s(o,T,n=n||{}),n},b.obj.copy=b.obj.copy||function(o){return o&&JSON.parse(JSON.stringify(o))},b.obj.empty=b.obj.empty||function(o,n){return!o||!s(o,N,{n})},V=Object.keys,Object.keys=Object.keys||function(o){return A(o,function(n,x,B){B(x)})},b.obj.map=A=b.obj.map||function(o,n,x){var B,M,K,z,L,F=0,R=typeof n=="function";if(E.r=B,V&&h(o)&&(z=V(o),L=!0),x=x||{},y(o)||z)for(M=(z||o).length;F<M;F++){var Z=F+b.list.index;if(R){if((K=L?n.call(x,o[z[F]],z[F],E):n.call(x,o[F],Z,E))!==B)return K}else if(n===o[L?z[F]:F])return z?z[F]:Z}else for(F in o)if(R){if($(o,F)&&(K=x?n.call(x,o[F],F,E):n(o[F],F,E))!==B)return K}else if(n===o[F])return F;return R?E.r:b.list.index?0:-1},b.time=b.time||{},b.time.is=b.time.is||function(o){return o?o instanceof Date:+new Date().getTime()};var c=b.fn.is,y=b.list.is,h=(t=b.obj).is,$=t.has,s=t.map,a={is:function(o){return o!==l&&(o===null||o!==1/0&&(!!(k(o)||v(o)||_(o))||a.link.is(o)||!1))}};a.link=a.rel={_:"#"},a.link.is=function(o){if(o&&o[d]&&!o._&&h(o)){var n={};if(s(o,u,n),n.id)return n.id}return!1},a.link.ify=function(o){return S({},d,o)},b.obj.has._=".";var d=a.link._,v=b.bi.is,_=b.num.is,k=b.text.is,S=(h=(t=b.obj).is,t.put);s=t.map,b.val=b.val||a;var p={_:"_",soul:function(o,n){return o&&o._&&o._[n||m]}};p.soul.ify=function(o,n){return n=typeof n=="string"?{soul:n}:n||{},(o=o||{})._=o._||{},o._[m]=n.soul||o._[m]||r(),o},p.soul._=a.link._,p.is=function(o,n,x){var B;return!!h(o)&&!!(B=p.soul(o))&&!s(o,D,{as:x,cb:n,s:B,n:o})},p.ify=function(o,n,x){return n?typeof n=="string"?n={soul:n}:typeof n=="function"&&(n={map:n}):n={},n.map&&(n.node=n.map.call(x,o,l,n.node||{})),(n.node=p.soul.ify(n.node||{},n))&&s(o,J,{o:n,as:x}),n.node},h=(t=b.obj).is;var i=t.del,r=(s=t.map,b.text.random),m=p.soul._;b.node=b.node||p;var e=b.state;e.lex=function(){return e().toString(36).replace(".","")},e.to=function(o,n,x){var B=(o||{})[n];return h(B)&&(B=f(B)),e.ify(x,n,e.is(o,n),B,p.soul(o))},e.map=function(o,n,x){var B=h(B=o||n)?B:null;return o=c(o=o||n)?o:null,B&&!o?(n=_(n)?n:e(),B[j]=B[j]||{},s(B,G,{o:B,s:n}),B):(x=x||h(n)?n:void 0,n=_(n)?n:e(),function(M,K,z,L){if(!o)return G.call({o:z,s:n},M,K),M;o.call(x||this||{},M,K,z,L),$(z,K)&&z[K]===void 0||G.call({o:z,s:n},M,K)})},(t=b.obj).as,$=t.has,h=t.is,s=t.map;var t,l,f=t.copy,j=(_=b.num.is,c=b.fn.is,p._),g={is:function(o,n,x,B){return!(!o||!h(o)||w(o)||s(o,W,{cb:n,fn:x,as:B}))},ify:function(o,n,x){var B={path:[],obj:o};return n?typeof n=="string"?n={soul:n}:typeof n=="function"&&(n.map=n):n={},typeof x=="string"&&(n.soul=n.soul||x,x=l),n.soul&&(B.link=a.link.ify(n.soul)),n.shell=(x||{}).shell,n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||x,I(n,B),n.root=B.node,n.graph},node:function(o){var n=p.soul(o);if(n)return S({},n,o)},to:function(o,n,x){if(o){var B={};return x=x||{seen:{}},s(o[n],U,{obj:B,graph:o,opt:x}),B}}},w=(c=b.fn.is,h=(t=b.obj).is,i=t.del,$=t.has,t.empty);S=t.put,s=t.map,f=t.copy,b.graph=b.graph||g}function T(O,o){$(this,o)&&this[o]!==void 0||(this[o]=O)}function N(O,o){var n=this.n;if(!n||!(o===n||h(n)&&$(n,o)))return o!==void 0||void 0}function E(O,o){arguments.length!==2?(E.r=E.r||[]).push(O):(E.r=E.r||{})[O]=o}function u(O,o){return this.id?this.id=!1:o==d&&k(O)?void(this.id=O):this.id=!1}function D(O,o){if(o!==p._)return!a.is(O)||void(this.cb&&this.cb.call(this.as,O,o,this.n,this.s))}function J(O,o){var n,x=this.o;x.map?(n=x.map.call(this.as,O,""+o,x.node))===void 0?i(x.node,o):x.node&&(x.node[o]=n):a.is(O)&&(x.node[o]=O)}function G(O,o){j!==o&&e.ify(this.o,o,this.s)}function W(O,o){if(!O||o!==p.soul(O)||!p.is(O,this.fn,this.as))return!0;this.cb&&(q.n=O,q.as=this.as,this.cb.call(q.as,O,o,q))}function q(O){O&&p.is(q.n,O,q.as)}function I(O,o){var n;return(n=function(x,B){for(var M,K=x.seen,z=K.length;z--;)if(M=K[z],B.obj===M.obj)return M;K.push(B)}(O,o))?n:(o.env=O,o.soul=C,p.ify(o.obj,P,o)&&(o.link=o.link||a.link.ify(p.soul(o.node)),o.obj!==O.shell&&(O.graph[a.link.is(o.link)]=o.node)),o)}function P(O,o,n){var x,B,M=this,K=M.env;if(p._===o&&$(O,a.link._))return n._;if(x=H(O,o,n,M,K)){if(o||(M.node=M.node||n||{},$(O,p._)&&p.soul(O)&&(M.node._=f(O._)),M.node=p.soul.ify(M.node,a.link.is(M.link)),M.link=M.link||a.link.ify(p.soul(M.node))),(B=K.map)&&(B.call(K.as||{},O,o,n,M),$(n,o))){if(O=n[o],l===O)return void i(n,o);if(!(x=H(O,o,n,M,K)))return}if(!o)return M.node;if(x===!0)return O;if((B=I(K,{obj:O,path:M.path.concat(o)})).node)return B.link}}function C(O){var o=this,n=a.link.is(o.link),x=o.env.graph;o.link=o.link||a.link.ify(O),o.link[a.link._]=O,o.node&&o.node[p._]&&(o.node[p._][a.link._]=O),$(x,n)&&(x[O]=x[n],i(x,n))}function H(O,o,n,x,B){var M;return!!a.is(O)||(h(O)?1:(M=B.invalid)?H(O=M.call(B.as||{},O,o,n),o,n,x,B):(B.err="Invalid value at '"+x.path.concat(o).join(".")+"'!",void(b.list.is(O)&&(B.err+=" Use `.set(item)` instead of an Array."))))}function U(O,o){var n,x;if(p._!==o)(n=a.link.is(O))?(x=this.opt.seen[n])?this.obj[o]=x:this.obj[o]=this.opt.seen[n]=g.to(this.graph,n,this.opt):this.obj[o]=O;else{if(w(O,a.link._))return;this.obj[o]=f(O)}}}()});te();})();
